import { LendingProtocol } from './lending-protocol';
import * as common from '@protocolink/common';
import { expect } from 'chai';
import { removePortfolioDynamicFields } from 'src/protocol.utils';

describe('Test Aave V3 LendingProtocol', function () {
  context('Test getPortfolio', function () {
    const testCases = [
      {
        chainId: common.ChainId.mainnet,
        account: '0xAF06acFD1BD492B913d5807d562e4FC3A6343C4E',
        blockTag: 18797586,
        expected: {
          chainId: 1,
          protocolId: 'aave-v3',
          marketId: 'mainnet',
          utilization: '1',
          healthRate: '0.93258246248607674253',
          netAPY: '0.05975227791860128594',
          totalSupplyUSD: '58114237.16604937106663955975306072',
          totalBorrowUSD: '50463931.85681213194668127693048362',
          supplies: [
            {
              token: {
                chainId: 1,
                address: '0x7Fc66500c84A76Ad7e9c93437bFc5Ac33E2DDaE9',
                decimals: 18,
                symbol: 'AAVE',
                name: 'Aave Token',
              },
              price: '105.0112',
              balance: '0',
              apy: '0',
              lstApy: '0',
              grossApy: '0',
              usageAsCollateralEnabled: true,
              ltv: '0.66',
              liquidationThreshold: '0.73',
              isNotCollateral: false,
              supplyCap: '1850000',
              totalSupply: '664698.902796470253474238',
            },
            {
              token: {
                chainId: 1,
                address: '0x6B175474E89094C44Da98b954EedeAC495271d0F',
                decimals: 18,
                symbol: 'DAI',
                name: 'Dai Stablecoin',
              },
              price: '1.00002272',
              balance: '0',
              apy: '0.04054069979413997238',
              lstApy: '0',
              grossApy: '0.04054069979413997238',
              usageAsCollateralEnabled: true,
              ltv: '0.77',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
              supplyCap: '338000000',
              totalSupply: '92918136.653764994943597984',
            },
            {
              token: {
                chainId: 1,
                address: '0x514910771AF9Ca656af840dff83E8264EcF986CA',
                decimals: 18,
                symbol: 'LINK',
                name: 'ChainLink Token',
              },
              price: '14.43048',
              balance: '0',
              apy: '0.00011292316266079384',
              lstApy: '0',
              grossApy: '0.00011292316266079384',
              usageAsCollateralEnabled: true,
              ltv: '0.53',
              liquidationThreshold: '0.68',
              isNotCollateral: false,
              supplyCap: '15000000',
              totalSupply: '6236919.227547270114317598',
            },
            {
              token: {
                chainId: 1,
                address: '0x5f98805A4E8be255a32880FDeC7F6728C6568bA0',
                decimals: 18,
                symbol: 'LUSD',
                name: 'LUSD Stablecoin',
              },
              price: '0.99907346',
              balance: '0',
              apy: '0.03577655473827457357',
              lstApy: '0',
              grossApy: '0.03577655473827457357',
              usageAsCollateralEnabled: true,
              ltv: '0.77',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
              supplyCap: '18000000',
              totalSupply: '5896849.384296611014905182',
            },
            {
              token: {
                chainId: 1,
                address: '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD Coin',
              },
              price: '1.00027726',
              balance: '0',
              apy: '0.04129249914555541349',
              lstApy: '0',
              grossApy: '0.04129249914555541349',
              usageAsCollateralEnabled: true,
              ltv: '0.77',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
              supplyCap: '1760000000',
              totalSupply: '451741481.616413',
            },
            {
              token: {
                chainId: 1,
                address: '0xdAC17F958D2ee523a2206206994597C13D831ec7',
                decimals: 6,
                symbol: 'USDT',
                name: 'Tether USD',
              },
              price: '0.99961',
              balance: '215169.250899',
              apy: '0.04113888262414266182',
              lstApy: '0',
              grossApy: '0.04113888262414266182',
              usageAsCollateralEnabled: true,
              ltv: '0.74',
              liquidationThreshold: '0.76',
              isNotCollateral: false,
              supplyCap: '600000000',
              totalSupply: '397684811.506379',
            },
            {
              token: {
                chainId: 1,
                address: '0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599',
                decimals: 8,
                symbol: 'WBTC',
                name: 'Wrapped BTC',
              },
              price: '42070.43411843',
              balance: '0',
              apy: '0.00088069472003505139',
              lstApy: '0',
              grossApy: '0.00088069472003505139',
              usageAsCollateralEnabled: true,
              ltv: '0.73',
              liquidationThreshold: '0.78',
              isNotCollateral: false,
              supplyCap: '43000',
              totalSupply: '11963.09759525',
            },
            {
              token: {
                chainId: 1,
                address: '0xBe9895146f7AF43049ca1c1AE358B0541Ea49704',
                decimals: 18,
                symbol: 'cbETH',
                name: 'Coinbase Wrapped Staked ETH',
              },
              price: '2367.23327843',
              balance: '0',
              apy: '0.00066155636243544685',
              lstApy: '0.0274',
              grossApy: '0.02806155636243544685',
              usageAsCollateralEnabled: true,
              ltv: '0.745',
              liquidationThreshold: '0.77',
              isNotCollateral: false,
              supplyCap: '60000',
              totalSupply: '12515.931125102669761257',
            },
            {
              token: {
                chainId: 1,
                address: '0xae78736Cd615f374D3085123A210448E74Fc6393',
                decimals: 18,
                symbol: 'rETH',
                name: 'Rocket Pool ETH',
              },
              price: '2450.18252296',
              balance: '0',
              apy: '0.00080602066709354148',
              lstApy: '0.0275',
              grossApy: '0.02830602066709354148',
              usageAsCollateralEnabled: true,
              ltv: '0.745',
              liquidationThreshold: '0.77',
              isNotCollateral: false,
              supplyCap: '60000',
              totalSupply: '48356.818649881665030164',
            },
            {
              token: {
                chainId: 1,
                address: '0x7f39C581F595B53c5cb19bD0b3f8dA6c935E2Ca0',
                decimals: 18,
                symbol: 'wstETH',
                name: 'Wrapped liquid staked Ether 2.0',
              },
              price: '2579.31314226',
              balance: '22447.507781248636639372',
              apy: '0.00002953692637359529',
              lstApy: '0.0324',
              grossApy: '0.03242953692637359529',
              usageAsCollateralEnabled: true,
              ltv: '0.785',
              liquidationThreshold: '0.81',
              isNotCollateral: false,
              supplyCap: '1100000',
              totalSupply: '766378.435528436226868079',
            },
            {
              token: {
                chainId: 1,
                address: '0x0000000000000000000000000000000000000000',
                decimals: 18,
                symbol: 'ETH',
                name: 'Ethereum',
              },
              price: '2242.39893',
              balance: '0',
              apy: '0.01912664906969010559',
              lstApy: '0',
              grossApy: '0.01912664906969010559',
              usageAsCollateralEnabled: true,
              ltv: '0.805',
              liquidationThreshold: '0.83',
              isNotCollateral: false,
              supplyCap: '1800000',
              totalSupply: '456717.169430435071384223',
            },
            {
              token: {
                chainId: 1,
                address: '0xba100000625a3754423978a60c9317c58a424e3D',
                decimals: 18,
                symbol: 'BAL',
                name: 'Balancer',
              },
              price: '4.00584039',
              balance: '0',
              apy: '0.02641882601000881679',
              lstApy: '0',
              grossApy: '0.02641882601000881679',
              usageAsCollateralEnabled: false,
              ltv: '0.57',
              liquidationThreshold: '0.62',
              isNotCollateral: false,
              supplyCap: '700000',
              totalSupply: '430927.692213809294956654',
            },
            {
              token: {
                chainId: 1,
                address: '0xD533a949740bb3306d119CC777fa900bA034cd52',
                decimals: 18,
                symbol: 'CRV',
                name: 'Curve DAO Token',
              },
              price: '0.64126945',
              balance: '0',
              apy: '0.00537209814152129923',
              lstApy: '0',
              grossApy: '0.00537209814152129923',
              usageAsCollateralEnabled: false,
              ltv: '0.35',
              liquidationThreshold: '0.41',
              isNotCollateral: false,
              supplyCap: '7500000',
              totalSupply: '2173163.169937050727109039',
            },
            {
              token: {
                chainId: 1,
                address: '0xC18360217D8F7Ab5e7c516566761Ea12Ce7F9D72',
                decimals: 18,
                symbol: 'ENS',
                name: 'Ethereum Name Service',
              },
              price: '8.70661924',
              balance: '0',
              apy: '0.00031956336766001557',
              lstApy: '0',
              grossApy: '0.00031956336766001557',
              usageAsCollateralEnabled: false,
              ltv: '0.39',
              liquidationThreshold: '0.49',
              isNotCollateral: false,
              supplyCap: '1000000',
              totalSupply: '44639.909893333904305634',
            },
            {
              token: {
                chainId: 1,
                address: '0x5A98FcBEA516Cf06857215779Fd812CA3beF1B32',
                decimals: 18,
                symbol: 'LDO',
                name: 'Lido DAO Token',
              },
              price: '2.15865322',
              balance: '0',
              apy: '0.00000908766059742753',
              lstApy: '0',
              grossApy: '0.00000908766059742753',
              usageAsCollateralEnabled: false,
              ltv: '0.4',
              liquidationThreshold: '0.5',
              isNotCollateral: false,
              supplyCap: '6000000',
              totalSupply: '1063337.005393092033367612',
            },
            {
              token: {
                chainId: 1,
                address: '0x9f8F72aA9304c8B593d555F12eF6589cC3A579A2',
                decimals: 18,
                symbol: 'MKR',
                name: 'Maker',
              },
              price: '1325.12484',
              balance: '0',
              apy: '0.00055163255868484246',
              lstApy: '0',
              grossApy: '0.00055163255868484246',
              usageAsCollateralEnabled: false,
              ltv: '0.65',
              liquidationThreshold: '0.7',
              isNotCollateral: false,
              supplyCap: '22500',
              totalSupply: '10681.629597624166611382',
            },
            {
              token: {
                chainId: 1,
                address: '0xC011a73ee8576Fb46F5E1c5751cA3B9Fe0af2a6F',
                decimals: 18,
                symbol: 'SNX',
                name: 'Synthetix Network Token',
              },
              price: '4.10424827',
              balance: '0',
              apy: '0.01535264061137685515',
              lstApy: '0',
              grossApy: '0.01535264061137685515',
              usageAsCollateralEnabled: false,
              ltv: '0.49',
              liquidationThreshold: '0.65',
              isNotCollateral: false,
              supplyCap: '2000000',
              totalSupply: '640607.360335350777431324',
            },
            {
              token: {
                chainId: 1,
                address: '0x1f9840a85d5aF5bf1D1762F925BDADdC4201F984',
                decimals: 18,
                symbol: 'UNI',
                name: 'Uniswap',
              },
              price: '6.1537289',
              balance: '0',
              apy: '0.0001541144618494753',
              lstApy: '0',
              grossApy: '0.0001541144618494753',
              usageAsCollateralEnabled: false,
              ltv: '0.65',
              liquidationThreshold: '0.77',
              isNotCollateral: false,
              supplyCap: '4000000',
              totalSupply: '2408925.806808387476923232',
            },
            {
              token: {
                chainId: 1,
                address: '0x111111111117dC0aa78b770fA6A738034120C302',
                decimals: 18,
                symbol: '1INCH',
                name: '1INCH Token',
              },
              price: '0.36715648',
              balance: '0',
              apy: '0.00001417275829874642',
              lstApy: '0',
              grossApy: '0.00001417275829874642',
              usageAsCollateralEnabled: false,
              ltv: '0.57',
              liquidationThreshold: '0.67',
              isNotCollateral: false,
              supplyCap: '22000000',
              totalSupply: '1284901.062132648467095204',
            },
            {
              token: {
                chainId: 1,
                address: '0x853d955aCEf822Db058eb8505911ED77F175b99e',
                decimals: 18,
                symbol: 'FRAX',
                name: 'Frax',
              },
              price: '0.99929064',
              balance: '0',
              apy: '0.03601976661346056869',
              lstApy: '0',
              grossApy: '0.03601976661346056869',
              usageAsCollateralEnabled: false,
              ltv: '0.7',
              liquidationThreshold: '0.75',
              isNotCollateral: false,
              supplyCap: '15000000',
              totalSupply: '688658.291640712360126327',
            },
            {
              token: {
                chainId: 1,
                address: '0xD33526068D116cE69F19A9ee46F0bd304F21A51f',
                decimals: 18,
                symbol: 'RPL',
                name: 'Rocket Pool Protocol',
              },
              price: '27.19493893',
              balance: '0',
              apy: '0.01559754249123508373',
              lstApy: '0',
              grossApy: '0.01559754249123508373',
              usageAsCollateralEnabled: false,
              ltv: '0',
              liquidationThreshold: '0',
              isNotCollateral: false,
              supplyCap: '840000',
              totalSupply: '451515.769089415208475783',
            },
            {
              token: {
                chainId: 1,
                address: '0xAf5191B0De278C7286d6C7CC6ab6BB8A73bA2Cd6',
                decimals: 18,
                symbol: 'STG',
                name: 'StargateToken',
              },
              price: '0.51794661',
              balance: '0',
              apy: '0.00000010978549004967',
              lstApy: '0',
              grossApy: '0.00000010978549004967',
              usageAsCollateralEnabled: false,
              ltv: '0.35',
              liquidationThreshold: '0.4',
              isNotCollateral: false,
              supplyCap: '10000000',
              totalSupply: '2004551.693873044729337211',
            },
            {
              token: {
                chainId: 1,
                address: '0xdeFA4e8a7bcBA345F687a2f1456F5Edd9CE97202',
                decimals: 18,
                symbol: 'KNC',
                name: 'Kyber Network Crystal v2',
              },
              price: '0.70404347',
              balance: '0',
              apy: '0.16162982443989215223',
              lstApy: '0',
              grossApy: '0.16162982443989215223',
              usageAsCollateralEnabled: false,
              ltv: '0.35',
              liquidationThreshold: '0.4',
              isNotCollateral: false,
              supplyCap: '1200000',
              totalSupply: '203598.367259294307723868',
            },
            {
              token: {
                chainId: 1,
                address: '0x3432B6A60D23Ca0dFCa7761B7ab56459D9C964D0',
                decimals: 18,
                symbol: 'FXS',
                name: 'Frax Share',
              },
              price: '8.58585071',
              balance: '0',
              apy: '0',
              lstApy: '0',
              grossApy: '0',
              usageAsCollateralEnabled: false,
              ltv: '0.35',
              liquidationThreshold: '0.45',
              isNotCollateral: false,
              supplyCap: '800000',
              totalSupply: '14018.815218722342773996',
            },
            {
              token: {
                chainId: 1,
                address: '0xf939E0A03FB07F59A73314E73794Be0E57ac1b4E',
                decimals: 18,
                symbol: 'crvUSD',
                name: 'Curve.Fi USD Stablecoin',
              },
              price: '0.9987005',
              balance: '0',
              apy: '0.03227369175779659042',
              lstApy: '0',
              grossApy: '0.03227369175779659042',
              usageAsCollateralEnabled: false,
              ltv: '0',
              liquidationThreshold: '0',
              isNotCollateral: false,
              supplyCap: '60000000',
              totalSupply: '139063.257077173287449294',
            },
          ],
          borrows: [
            {
              token: {
                chainId: 1,
                address: '0x6B175474E89094C44Da98b954EedeAC495271d0F',
                decimals: 18,
                symbol: 'DAI',
                name: 'Dai Stablecoin',
              },
              price: '1.00002272',
              balance: '0',
              apy: '0.05077600393079828611',
              lstApy: '0',
              grossApy: '0.05077600393079828611',
              borrowMin: '0',
              borrowCap: '271000000',
              totalBorrow: '82838987.172690904611446783',
            },
            {
              token: {
                chainId: 1,
                address: '0x514910771AF9Ca656af840dff83E8264EcF986CA',
                decimals: 18,
                symbol: 'LINK',
                name: 'ChainLink Token',
              },
              price: '14.43048',
              balance: '0',
              apy: '0.00469672266338061558',
              lstApy: '0',
              grossApy: '0.00469672266338061558',
              borrowMin: '0',
              borrowCap: '13000000',
              totalBorrow: '187871.836490316380222276',
            },
            {
              token: {
                chainId: 1,
                address: '0x5f98805A4E8be255a32880FDeC7F6728C6568bA0',
                decimals: 18,
                symbol: 'LUSD',
                name: 'LUSD Stablecoin',
              },
              price: '0.99907346',
              balance: '0',
              apy: '0.05064809600568456771',
              lstApy: '0',
              grossApy: '0.05064809600568456771',
              borrowMin: '0',
              borrowCap: '8000000',
              totalBorrow: '4661610.161174071343711259',
            },
            {
              token: {
                chainId: 1,
                address: '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD Coin',
              },
              price: '1.00027726',
              balance: '0',
              apy: '0.05124690480066431282',
              lstApy: '0',
              grossApy: '0.05124690480066431282',
              borrowMin: '0',
              borrowCap: '1580000000',
              totalBorrow: '406390100.165723',
            },
            {
              token: {
                chainId: 1,
                address: '0xdAC17F958D2ee523a2206206994597C13D831ec7',
                decimals: 6,
                symbol: 'USDT',
                name: 'Tether USD',
              },
              price: '0.99961',
              balance: '0',
              apy: '0.05115103904810626772',
              lstApy: '0',
              grossApy: '0.05115103904810626772',
              borrowMin: '0',
              borrowCap: '500000000',
              totalBorrow: '357102470.630928',
            },
            {
              token: {
                chainId: 1,
                address: '0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599',
                decimals: 8,
                symbol: 'WBTC',
                name: 'Wrapped BTC',
              },
              price: '42070.43411843',
              balance: '0',
              apy: '0.00993905766729966149',
              lstApy: '0',
              grossApy: '0.00993905766729966149',
              borrowMin: '0',
              borrowCap: '28000',
              totalBorrow: '1331.04368336',
            },
            {
              token: {
                chainId: 1,
                address: '0xBe9895146f7AF43049ca1c1AE358B0541Ea49704',
                decimals: 18,
                symbol: 'cbETH',
                name: 'Coinbase Wrapped Staked ETH',
              },
              price: '2367.23327843',
              balance: '0',
              apy: '0.01106206012748106734',
              lstApy: '0.0274',
              grossApy: '-0.01633793987251893266',
              borrowMin: '0',
              borrowCap: '2400',
              totalBorrow: '885.162922097405223302',
            },
            {
              token: {
                chainId: 1,
                address: '0xae78736Cd615f374D3085123A210448E74Fc6393',
                decimals: 18,
                symbol: 'rETH',
                name: 'Rocket Pool ETH',
              },
              price: '2450.18252296',
              balance: '0',
              apy: '0.01221682491528295028',
              lstApy: '0.0275',
              grossApy: '-0.01528317508471704972',
              borrowMin: '0',
              borrowCap: '19200',
              totalBorrow: '3774.785469677145439116',
            },
            {
              token: {
                chainId: 1,
                address: '0x7f39C581F595B53c5cb19bD0b3f8dA6c935E2Ca0',
                decimals: 18,
                symbol: 'wstETH',
                name: 'Wrapped liquid staked Ether 2.0',
              },
              price: '2579.31314226',
              balance: '0.000000000199591537',
              apy: '0.00350052367445749632',
              lstApy: '0.0324',
              grossApy: '-0.02889947632554250368',
              borrowMin: '0',
              borrowCap: '24000',
              totalBorrow: '7620.954012786860698391',
            },
            {
              token: {
                chainId: 1,
                address: '0x0000000000000000000000000000000000000000',
                decimals: 18,
                symbol: 'ETH',
                name: 'Ethereum',
              },
              price: '2242.39893',
              balance: '22504.439857546496928451',
              apy: '0.02832454450272690728',
              lstApy: '0',
              grossApy: '0.02832454450272690728',
              borrowMin: '0',
              borrowCap: '1400000',
              totalBorrow: '364472.9473151526740187',
            },
            {
              token: {
                chainId: 1,
                address: '0xba100000625a3754423978a60c9317c58a424e3D',
                decimals: 18,
                symbol: 'BAL',
                name: 'Balancer',
              },
              price: '4.00584039',
              balance: '0',
              apy: '0.13079543144860774213',
              lstApy: '0',
              grossApy: '0.13079543144860774213',
              borrowMin: '0',
              borrowCap: '185000',
              totalBorrow: '114456.291227146335280441',
            },
            {
              token: {
                chainId: 1,
                address: '0xD533a949740bb3306d119CC777fa900bA034cd52',
                decimals: 18,
                symbol: 'CRV',
                name: 'Curve DAO Token',
              },
              price: '0.64126945',
              balance: '0',
              apy: '0.06001629796737378854',
              lstApy: '0',
              grossApy: '0.06001629796737378854',
              borrowMin: '0',
              borrowCap: '5000000',
              totalBorrow: '307508.291167649884187053',
            },
            {
              token: {
                chainId: 1,
                address: '0xC18360217D8F7Ab5e7c516566761Ea12Ce7F9D72',
                decimals: 18,
                symbol: 'ENS',
                name: 'Ethereum Name Service',
              },
              price: '8.70661924',
              balance: '0',
              apy: '0.00897751203969010139',
              lstApy: '0',
              grossApy: '0.00897751203969010139',
              borrowMin: '0',
              borrowCap: '40000',
              totalBorrow: '1995.184522027963041865',
            },
            {
              token: {
                chainId: 1,
                address: '0x5A98FcBEA516Cf06857215779Fd812CA3beF1B32',
                decimals: 18,
                symbol: 'LDO',
                name: 'Lido DAO Token',
              },
              price: '2.15865322',
              balance: '0',
              apy: '0.00133018338243446772',
              lstApy: '0',
              grossApy: '0.00133018338243446772',
              borrowMin: '0',
              borrowCap: '3000000',
              totalBorrow: '9086.759136089184224493',
            },
            {
              token: {
                chainId: 1,
                address: '0x9f8F72aA9304c8B593d555F12eF6589cC3A579A2',
                decimals: 18,
                symbol: 'MKR',
                name: 'Maker',
              },
              price: '1325.12484',
              balance: '0',
              apy: '0.0104091053083956077',
              lstApy: '0',
              grossApy: '0.0104091053083956077',
              borrowMin: '0',
              borrowCap: '3000',
              totalBorrow: '711.084235034181327029',
            },
            {
              token: {
                chainId: 1,
                address: '0xC011a73ee8576Fb46F5E1c5751cA3B9Fe0af2a6F',
                decimals: 18,
                symbol: 'SNX',
                name: 'Synthetix Network Token',
              },
              price: '4.10424827',
              balance: '0',
              apy: '0.08650980183324964408',
              lstApy: '0',
              grossApy: '0.08650980183324964408',
              borrowMin: '0',
              borrowCap: '1100000',
              totalBorrow: '180987.280847909227098604',
            },
            {
              token: {
                chainId: 1,
                address: '0x1f9840a85d5aF5bf1D1762F925BDADdC4201F984',
                decimals: 18,
                symbol: 'UNI',
                name: 'Uniswap',
              },
              price: '6.1537289',
              balance: '0',
              apy: '0.00548898362962160323',
              lstApy: '0',
              grossApy: '0.00548898362962160323',
              borrowMin: '0',
              borrowCap: '500000',
              totalBorrow: '84770.250092805917840859',
            },
            {
              token: {
                chainId: 1,
                address: '0x40D16FC0246aD3160Ccc09B8D0D3A2cD28aE6C2f',
                decimals: 18,
                symbol: 'GHO',
                name: 'Gho Token',
              },
              price: '1',
              balance: '0',
              apy: '0.05358643868526975825',
              lstApy: '0',
              grossApy: '0.05358643868526975825',
              borrowMin: '0',
              borrowCap: '35000000',
              totalBorrow: '35001304.853742346875010307',
            },
            {
              token: {
                chainId: 1,
                address: '0x111111111117dC0aa78b770fA6A738034120C302',
                decimals: 18,
                symbol: '1INCH',
                name: '1INCH Token',
              },
              price: '0.36715648',
              balance: '0',
              apy: '0.00188410222613479303',
              lstApy: '0',
              grossApy: '0.00188410222613479303',
              borrowMin: '0',
              borrowCap: '720000',
              totalBorrow: '12093.125945788493413928',
            },
            {
              token: {
                chainId: 1,
                address: '0x853d955aCEf822Db058eb8505911ED77F175b99e',
                decimals: 18,
                symbol: 'FRAX',
                name: 'Frax',
              },
              price: '0.99929064',
              balance: '0',
              apy: '0.0478462503067623037',
              lstApy: '0',
              grossApy: '0.0478462503067623037',
              borrowMin: '0',
              borrowCap: '12000000',
              totalBorrow: '579355.922074445957174638',
            },
            {
              token: {
                chainId: 1,
                address: '0xD33526068D116cE69F19A9ee46F0bd304F21A51f',
                decimals: 18,
                symbol: 'RPL',
                name: 'Rocket Pool Protocol',
              },
              price: '27.19493893',
              balance: '0',
              apy: '0.04638176421561664829',
              lstApy: '0',
              grossApy: '0.04638176421561664829',
              borrowMin: '0',
              borrowCap: '480000',
              totalBorrow: '192691.126841746370860172',
            },
            {
              token: {
                chainId: 1,
                address: '0xdeFA4e8a7bcBA345F687a2f1456F5Edd9CE97202',
                decimals: 18,
                symbol: 'KNC',
                name: 'Kyber Network Crystal v2',
              },
              price: '0.70404347',
              balance: '0',
              apy: '0.45228185272606608958',
              lstApy: '0',
              grossApy: '0.45228185272606608958',
              borrowMin: '0',
              borrowCap: '650000',
              totalBorrow: '102217.846911972107952927',
            },
            {
              token: {
                chainId: 1,
                address: '0xf939E0A03FB07F59A73314E73794Be0E57ac1b4E',
                decimals: 18,
                symbol: 'crvUSD',
                name: 'Curve.Fi USD Stablecoin',
              },
              price: '0.9987005',
              balance: '0',
              apy: '0.04808656168165237238',
              lstApy: '0',
              grossApy: '0.04808656168165237238',
              borrowMin: '0',
              borrowCap: '50000000',
              totalBorrow: '104506.605695275372946496',
            },
          ],
        },
      },
      {
        chainId: common.ChainId.gnosis,
        account: '0xd0214b7e8a7821a5cb07024bc00d64ece8cc1067',
        blockTag: 32001300,
        expected: {
          chainId: 100,
          protocolId: 'aave-v3',
          marketId: 'gnosis',
          utilization: '0.52772311717694312522',
          healthRate: '1.97073041932194302686',
          totalSupplyUSD: '126866.022202106736436498',
          totalBorrowUSD: '50212.59952525128102917535054923',
          supplies: [
            {
              token: {
                chainId: 100,
                address: '0x6A023CCd1ff6F2045C3309768eAd9E68F978f6e1',
                decimals: 18,
                symbol: 'WETH',
                name: 'Wrapped Ether on xDai',
              },
              price: '2534.9',
              balance: '50.04774239698084202',
              apy: '0.00761306207708669056',
              usageAsCollateralEnabled: true,
              ltv: '0.75',
              liquidationThreshold: '0.78',
              isNotCollateral: false,
              supplyCap: '4000',
              totalSupply: '2314.964437127338665368',
            },
            {
              token: {
                chainId: 100,
                address: '0x6C76971f98945AE98dD7d4DFcA8711ebea946eA6',
                decimals: 18,
                symbol: 'wstETH',
                name: 'Wrapped liquid staked Ether 2.0 from Mainnet',
              },
              price: '2925.2912629',
              balance: '0',
              apy: '0.00000000025288227545',
              usageAsCollateralEnabled: true,
              ltv: '0.75',
              liquidationThreshold: '0.78',
              isNotCollateral: false,
              supplyCap: '5000',
              totalSupply: '3798.234794199409162802',
            },
            {
              token: {
                chainId: 100,
                address: '0x9C58BAcC331c9aa871AFD802DB6379a98e80CEdb',
                decimals: 18,
                symbol: 'GNO',
                name: 'Gnosis Token on xDai',
              },
              price: '215.694',
              balance: '0',
              apy: '0.0000233014041152648',
              usageAsCollateralEnabled: false,
              ltv: '0.31',
              liquidationThreshold: '0.36',
              isNotCollateral: false,
              supplyCap: '40000',
              totalSupply: '26469.306100102939105313',
            },
            {
              token: {
                chainId: 100,
                address: '0xDDAfbb505ad214D7b80b1f830fcCc89B60fb7A83',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD//C on xDai',
              },
              price: '1.00009316',
              balance: '0',
              apy: '0.03487021193804434009',
              usageAsCollateralEnabled: true,
              ltv: '0.77',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
              supplyCap: '1500000',
              totalSupply: '1080122.051118',
            },
            {
              token: {
                chainId: 100,
                address: '0x0000000000000000000000000000000000000000',
                decimals: 18,
                symbol: 'xDAI',
                name: 'xDai',
              },
              price: '0.99981787',
              balance: '0',
              apy: '0.04469137172265371084',
              usageAsCollateralEnabled: true,
              ltv: '0.77',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
              supplyCap: '2300000',
              totalSupply: '1082520.139404795483024586',
            },
            {
              token: {
                chainId: 100,
                address: '0xcB444e90D8198415266c6a2724b7900fb12FC56E',
                decimals: 18,
                symbol: 'EURe',
                name: 'Monerium EUR emoney',
              },
              price: '1.0894',
              balance: '0',
              apy: '0.01985047309378094259',
              usageAsCollateralEnabled: false,
              ltv: '0',
              liquidationThreshold: '0',
              isNotCollateral: false,
              supplyCap: '750000',
              totalSupply: '572291.696788509506019059',
            },
            {
              token: {
                chainId: 100,
                address: '0xaf204776c7245bF4147c2612BF6e5972Ee483701',
                decimals: 18,
                symbol: 'sDAI',
                name: 'Savings xDAI ',
              },
              price: '1.03557393',
              balance: '0',
              apy: '0',
              usageAsCollateralEnabled: true,
              ltv: '0.77',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
              supplyCap: '6000000',
              totalSupply: '1535851.908876436024002253',
            },
          ],
          borrows: [
            {
              token: {
                chainId: 100,
                address: '0x6A023CCd1ff6F2045C3309768eAd9E68F978f6e1',
                decimals: 18,
                symbol: 'WETH',
                name: 'Wrapped Ether on xDai',
              },
              price: '2534.9',
              balance: '0',
              apy: '0.01937005380783217141',
              grossApy: '0.01937005380783217141',
              borrowMin: '0',
              borrowCap: '3500',
              totalBorrow: '1076.67932159482269314',
            },
            {
              token: {
                chainId: 100,
                address: '0x6C76971f98945AE98dD7d4DFcA8711ebea946eA6',
                decimals: 18,
                symbol: 'wstETH',
                name: 'Wrapped liquid staked Ether 2.0 from Mainnet',
              },
              price: '2925.2912629',
              balance: '0',
              apy: '0.00000680289821047039',
              grossApy: '-0.03239319710178952961',
              borrowMin: '0',
              borrowCap: '400',
              totalBorrow: '0.166107322574699592',
            },
            {
              token: {
                chainId: 100,
                address: '0x9C58BAcC331c9aa871AFD802DB6379a98e80CEdb',
                decimals: 18,
                symbol: 'GNO',
                name: 'Gnosis Token on xDai',
              },
              price: '215.694',
              balance: '0',
              apy: '0.00233965441493896007',
              grossApy: '0.00233965441493896007',
              borrowMin: '0',
              borrowCap: '1100',
              totalBorrow: '329.903640471858495928',
            },
            {
              token: {
                chainId: 100,
                address: '0xDDAfbb505ad214D7b80b1f830fcCc89B60fb7A83',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD//C on xDai',
              },
              price: '1.00009316',
              balance: '0',
              apy: '0.05167921355207303083',
              grossApy: '0.05167921355207303083',
              borrowMin: '0',
              borrowCap: '1500000',
              totalBorrow: '816413.001448',
            },
            {
              token: {
                chainId: 100,
                address: '0x0000000000000000000000000000000000000000',
                decimals: 18,
                symbol: 'xDAI',
                name: 'xDai',
              },
              price: '0.99981787',
              balance: '50221.746411925284981329',
              apy: '0.05855943637730762431',
              grossApy: '0.05855943637730762431',
              borrowMin: '0',
              borrowCap: '2300000',
              totalBorrow: '924127.024179326995013372',
            },
            {
              token: {
                chainId: 100,
                address: '0xcB444e90D8198415266c6a2724b7900fb12FC56E',
                decimals: 18,
                symbol: 'EURe',
                name: 'Monerium EUR emoney',
              },
              price: '1.0894',
              balance: '0',
              apy: '0.03257820582035877173',
              grossApy: '0.03257820582035877173',
              borrowMin: '0',
              borrowCap: '750000',
              totalBorrow: '412826.531298661017523169',
            },
          ],
        },
      },
      {
        chainId: common.ChainId.polygon,
        account: '0x1DC6074361a3cddEe55A61C92BCf7dE1667e1096',
        blockTag: 52616458,
        expected: {
          chainId: 137,
          protocolId: 'aave-v3',
          marketId: 'polygon',
          utilization: '1',
          healthRate: '1.01912695773440167152',
          netAPY: '0.09680210623696668337',
          totalSupplyUSD: '2399624.08138503339496109506449456',
          totalBorrowUSD: '1865718.00182642499476896404',
          supplies: [
            {
              token: {
                chainId: 137,
                address: '0x9a71012B13CA4d3D0Cdc72A177DF3ef03b0E76A3',
                decimals: 18,
                symbol: 'BAL',
                name: 'Balancer (PoS)',
              },
              price: '3.8199',
              balance: '0',
              apy: '0.02002922306345584304',
              lstApy: '0',
              grossApy: '0.02002922306345584304',
              usageAsCollateralEnabled: true,
              ltv: '0.2',
              liquidationThreshold: '0.45',
              isNotCollateral: false,
              supplyCap: '361000',
              totalSupply: '321924.31611702657856073',
            },
            {
              token: {
                chainId: 137,
                address: '0x172370d5Cd63279eFa6d502DAB29171933a610AF',
                decimals: 18,
                symbol: 'CRV',
                name: 'CRV (PoS)',
              },
              price: '0.50862484',
              balance: '0',
              apy: '0.00167490823291584087',
              lstApy: '0',
              grossApy: '0.00167490823291584087',
              usageAsCollateralEnabled: true,
              ltv: '0.35',
              liquidationThreshold: '0.5',
              isNotCollateral: false,
              supplyCap: '1400000',
              totalSupply: '1399999.842073751162795782',
            },
            {
              token: {
                chainId: 137,
                address: '0x8f3Cf7ad23Cd3CaDbD9735AFf958023239c6A063',
                decimals: 18,
                symbol: 'DAI',
                name: '(PoS) Dai Stablecoin',
              },
              price: '0.9997124',
              balance: '0',
              apy: '0.05818241878150531623',
              lstApy: '0',
              grossApy: '0.05818241878150531623',
              usageAsCollateralEnabled: true,
              ltv: '0.76',
              liquidationThreshold: '0.81',
              isNotCollateral: false,
              supplyCap: '45000000',
              totalSupply: '13622642.205359433623165123',
            },
            {
              token: {
                chainId: 137,
                address: '0x85955046DF4668e1DD369D2DE9f3AEB98DD2A369',
                decimals: 18,
                symbol: 'DPI',
                name: 'DefiPulse Index (PoS)',
              },
              price: '97.06558737',
              balance: '0',
              apy: '0.00210522545122289326',
              lstApy: '0',
              grossApy: '0.00210522545122289326',
              usageAsCollateralEnabled: true,
              ltv: '0.2',
              liquidationThreshold: '0.45',
              isNotCollateral: false,
              supplyCap: '1417',
              totalSupply: '1286.970762606696798161',
            },
            {
              token: {
                chainId: 137,
                address: '0xE111178A87A3BFf0c8d18DECBa5798827539Ae99',
                decimals: 2,
                symbol: 'EURS',
                name: 'STASIS EURS Token (PoS)',
              },
              price: '1.0891',
              balance: '0',
              apy: '0.10848185772552146882',
              lstApy: '0',
              grossApy: '0.10848185772552146882',
              usageAsCollateralEnabled: false,
              ltv: '0.65',
              liquidationThreshold: '0.7',
              isNotCollateral: false,
              supplyCap: '4000000',
              totalSupply: '638136.93',
            },
            {
              token: {
                chainId: 137,
                address: '0x385Eeac5cB85A38A9a07A70c73e0a3271CfB54A7',
                decimals: 18,
                symbol: 'GHST',
                name: 'Aavegotchi GHST Token (PoS)',
              },
              price: '0.92809494',
              balance: '0',
              apy: '0.00001668015726549667',
              lstApy: '0',
              grossApy: '0.00001668015726549667',
              usageAsCollateralEnabled: true,
              ltv: '0',
              liquidationThreshold: '0.45',
              isNotCollateral: false,
              supplyCap: '4650000',
              totalSupply: '1967551.860036098899472255',
            },
            {
              token: {
                chainId: 137,
                address: '0x53E0bca35eC356BD5ddDFebbD1Fc0fD03FaBad39',
                decimals: 18,
                symbol: 'LINK',
                name: 'ChainLink Token',
              },
              price: '15.10453759',
              balance: '0',
              apy: '0.00067952244806186199',
              lstApy: '0',
              grossApy: '0.00067952244806186199',
              usageAsCollateralEnabled: true,
              ltv: '0.53',
              liquidationThreshold: '0.68',
              isNotCollateral: false,
              supplyCap: '668000',
              totalSupply: '491123.655931262791244082',
            },
            {
              token: {
                chainId: 137,
                address: '0x0b3F868E0BE5597D5DB7fEB59E1CADBb0fdDa50a',
                decimals: 18,
                symbol: 'SUSHI',
                name: 'SushiToken (PoS)',
              },
              price: '1.07296128',
              balance: '0',
              apy: '0.00816142167724243743',
              lstApy: '0',
              grossApy: '0.00816142167724243743',
              usageAsCollateralEnabled: true,
              ltv: '0.2',
              liquidationThreshold: '0.45',
              isNotCollateral: false,
              supplyCap: '299320',
              totalSupply: '298502.332882443555732093',
            },
            {
              token: {
                chainId: 137,
                address: '0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174',
                decimals: 6,
                symbol: 'USDC.e',
                name: 'USD Coin (PoS)',
              },
              price: '1.00004923',
              balance: '0',
              apy: '0.05005309529117560435',
              lstApy: '0',
              grossApy: '0.05005309529117560435',
              usageAsCollateralEnabled: true,
              ltv: '0.77',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
              supplyCap: '48000000',
              totalSupply: '40991465.5107',
            },
            {
              token: {
                chainId: 137,
                address: '0xc2132D05D31c914a87C6611C10748AEb04B58e8F',
                decimals: 6,
                symbol: 'USDT',
                name: '(PoS) Tether USD',
              },
              price: '0.99915929',
              balance: '0',
              apy: '0.04821917565153564696',
              lstApy: '0',
              grossApy: '0.04821917565153564696',
              usageAsCollateralEnabled: false,
              ltv: '0.75',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
              supplyCap: '45000000',
              totalSupply: '23213025.825448',
            },
            {
              token: {
                chainId: 137,
                address: '0x1BFD67037B42Cf73acF2047067bd4F2C47D9BfD6',
                decimals: 8,
                symbol: 'WBTC',
                name: '(PoS) Wrapped BTC',
              },
              price: '40636.42',
              balance: '0',
              apy: '0.00008990365467695733',
              lstApy: '0',
              grossApy: '0.00008990365467695733',
              usageAsCollateralEnabled: true,
              ltv: '0.73',
              liquidationThreshold: '0.78',
              isNotCollateral: false,
              supplyCap: '3100',
              totalSupply: '1567.30181081',
            },
            {
              token: {
                chainId: 137,
                address: '0x7ceB23fD6bC0adD59E62ac25578270cFf1b9f619',
                decimals: 18,
                symbol: 'WETH',
                name: 'Wrapped Ether',
              },
              price: '2376.94',
              balance: '0',
              apy: '0.00363887588134506367',
              lstApy: '0',
              grossApy: '0.00363887588134506367',
              usageAsCollateralEnabled: true,
              ltv: '0.8',
              liquidationThreshold: '0.825',
              isNotCollateral: false,
              supplyCap: '50000',
              totalSupply: '26134.275253557865157633',
            },
            {
              token: {
                chainId: 137,
                address: '0xE0B52e49357Fd4DAf2c15e02058DCE6BC0057db4',
                decimals: 18,
                symbol: 'agEUR',
                name: 'agEUR',
              },
              price: '1.0891',
              balance: '0',
              apy: '0.02574028648793511233',
              lstApy: '0',
              grossApy: '0.02574028648793511233',
              usageAsCollateralEnabled: false,
              ltv: '0',
              liquidationThreshold: '0',
              isNotCollateral: false,
              supplyCap: '300000',
              totalSupply: '131288.5194253471455371',
            },
            {
              token: {
                chainId: 137,
                address: '0xD6DF932A45C0f255f85145f286eA0b292B21C90B',
                decimals: 18,
                symbol: 'AAVE',
                name: 'Aave (PoS)',
              },
              price: '93.40322015',
              balance: '0',
              apy: '0',
              lstApy: '0',
              grossApy: '0',
              usageAsCollateralEnabled: true,
              ltv: '0.6',
              liquidationThreshold: '0.7',
              isNotCollateral: false,
              supplyCap: '70000',
              totalSupply: '58209.209999740424265359',
            },
            {
              token: {
                chainId: 137,
                address: '0xfa68FB4628DFF1028CFEc22b4162FCcd0d45efb6',
                decimals: 18,
                symbol: 'MaticX',
                name: 'Liquid Staking Matic (PoS)',
              },
              price: '0.82843552',
              balance: '0',
              apy: '0.00000549094101235202',
              lstApy: '0.0515',
              grossApy: '0.05150549094101235202',
              usageAsCollateralEnabled: true,
              ltv: '0.45',
              liquidationThreshold: '0.58',
              isNotCollateral: false,
              supplyCap: '62000000',
              totalSupply: '59239934.229162505530144725',
            },
            {
              token: {
                chainId: 137,
                address: '0x3A58a54C066FdC0f2D55FC9C89F0415C92eBf3C4',
                decimals: 18,
                symbol: 'stMATIC',
                name: 'Staked MATIC (PoS)',
              },
              price: '0.83364022',
              balance: '0',
              apy: '0',
              lstApy: '0.0427',
              grossApy: '0.0427',
              usageAsCollateralEnabled: true,
              ltv: '0.45',
              liquidationThreshold: '0.56',
              isNotCollateral: false,
              supplyCap: '57000000',
              totalSupply: '42465477.211917534806113221',
            },
            {
              token: {
                chainId: 137,
                address: '0x0000000000000000000000000000000000001010',
                decimals: 18,
                symbol: 'MATIC',
                name: 'Matic Token',
              },
              price: '0.75568306',
              balance: '0',
              apy: '0.01121879547113501188',
              lstApy: '0',
              grossApy: '0.01121879547113501188',
              usageAsCollateralEnabled: true,
              ltv: '0.68',
              liquidationThreshold: '0.73',
              isNotCollateral: false,
              supplyCap: '105000000',
              totalSupply: '55218285.848639211808737302',
            },
            {
              token: {
                chainId: 137,
                address: '0x03b54A6e9a984069379fae1a4fC4dBAE93B3bCCD',
                decimals: 18,
                symbol: 'wstETH',
                name: 'Wrapped liquid staked Ether 2.0 (PoS)',
              },
              price: '2744.10223788',
              balance: '666.730038837402303012',
              apy: '0.00022311165863094799',
              lstApy: '0.0324',
              grossApy: '0.03262311165863094799',
              usageAsCollateralEnabled: true,
              ltv: '0.7',
              liquidationThreshold: '0.79',
              isNotCollateral: false,
              supplyCap: '4370',
              totalSupply: '4370.005402270749328559',
            },
            {
              token: {
                chainId: 137,
                address: '0x3c499c542cEF5E3811e1192ce70d8cC03d5c3359',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD Coin',
              },
              price: '1.00004923',
              balance: '570020.627634',
              apy: '0.04936424064454017522',
              lstApy: '0',
              grossApy: '0.04936424064454017522',
              usageAsCollateralEnabled: true,
              ltv: '0.77',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
              supplyCap: '50000000',
              totalSupply: '7191850.905956',
            },
          ],
          borrows: [
            {
              token: {
                chainId: 137,
                address: '0x9a71012B13CA4d3D0Cdc72A177DF3ef03b0E76A3',
                decimals: 18,
                symbol: 'BAL',
                name: 'Balancer (PoS)',
              },
              price: '3.8199',
              balance: '0',
              apy: '0.1176933308388423909',
              lstApy: '0',
              grossApy: '0.1176933308388423909',
              borrowMin: '0',
              borrowCap: '290000',
              totalBorrow: '71725.486793026793520805',
            },
            {
              token: {
                chainId: 137,
                address: '0x172370d5Cd63279eFa6d502DAB29171933a610AF',
                decimals: 18,
                symbol: 'CRV',
                name: 'CRV (PoS)',
              },
              price: '0.50862484',
              balance: '0',
              apy: '0.04308746073685617397',
              lstApy: '0',
              grossApy: '0.04308746073685617397',
              borrowMin: '0',
              borrowCap: '300000',
              totalBorrow: '85232.603997646579741869',
            },
            {
              token: {
                chainId: 137,
                address: '0x8f3Cf7ad23Cd3CaDbD9735AFf958023239c6A063',
                decimals: 18,
                symbol: 'DAI',
                name: '(PoS) Dai Stablecoin',
              },
              price: '0.9997124',
              balance: '0',
              apy: '0.07255347299904361661',
              lstApy: '0',
              grossApy: '0.07255347299904361661',
              borrowMin: '0',
              borrowCap: '30000000',
              totalBorrow: '11982555.305162330504009063',
            },
            {
              token: {
                chainId: 137,
                address: '0x85955046DF4668e1DD369D2DE9f3AEB98DD2A369',
                decimals: 18,
                symbol: 'DPI',
                name: 'DefiPulse Index (PoS)',
              },
              price: '97.06558737',
              balance: '0',
              apy: '0.02717650141807873223',
              lstApy: '0',
              grossApy: '0.02717650141807873223',
              borrowMin: '0',
              borrowCap: '779',
              totalBorrow: '155.291766166075835511',
            },
            {
              token: {
                chainId: 137,
                address: '0xE111178A87A3BFf0c8d18DECBa5798827539Ae99',
                decimals: 2,
                symbol: 'EURS',
                name: 'STASIS EURS Token (PoS)',
              },
              price: '1.0891',
              balance: '0',
              apy: '0.16114954264563478469',
              lstApy: '0',
              grossApy: '0.16114954264563478469',
              borrowMin: '0',
              borrowCap: '1500000',
              totalBorrow: '456096.86',
            },
            {
              token: {
                chainId: 137,
                address: '0x385Eeac5cB85A38A9a07A70c73e0a3271CfB54A7',
                decimals: 18,
                symbol: 'GHST',
                name: 'Aavegotchi GHST Token (PoS)',
              },
              price: '0.92809494',
              balance: '0',
              apy: '0.00199994598157854839',
              lstApy: '0',
              grossApy: '0.00199994598157854839',
              borrowMin: '0',
              borrowCap: '220000',
              totalBorrow: '25271.152769497716894865',
            },
            {
              token: {
                chainId: 137,
                address: '0x53E0bca35eC356BD5ddDFebbD1Fc0fD03FaBad39',
                decimals: 18,
                symbol: 'LINK',
                name: 'ChainLink Token',
              },
              price: '15.10453759',
              balance: '0',
              apy: '0.01155909775809663145',
              lstApy: '0',
              grossApy: '0.01155909775809663145',
              borrowMin: '0',
              borrowCap: '163702',
              totalBorrow: '36285.35358453251905654',
            },
            {
              token: {
                chainId: 137,
                address: '0x0b3F868E0BE5597D5DB7fEB59E1CADBb0fdDa50a',
                decimals: 18,
                symbol: 'SUSHI',
                name: 'SushiToken (PoS)',
              },
              price: '1.07296128',
              balance: '0',
              apy: '0.04055635960572941586',
              lstApy: '0',
              grossApy: '0.04055635960572941586',
              borrowMin: '0',
              borrowCap: '180000',
              totalBorrow: '76290.550885626697952856',
            },
            {
              token: {
                chainId: 137,
                address: '0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174',
                decimals: 6,
                symbol: 'USDC.e',
                name: 'USD Coin (PoS)',
              },
              price: '1.00004923',
              balance: '0',
              apy: '0.07223240658412114427',
              lstApy: '0',
              grossApy: '0.07223240658412114427',
              borrowMin: '0',
              borrowCap: '43500000',
              totalBorrow: '33499763.793836',
            },
            {
              token: {
                chainId: 137,
                address: '0xc2132D05D31c914a87C6611C10748AEb04B58e8F',
                decimals: 6,
                symbol: 'USDT',
                name: '(PoS) Tether USD',
              },
              price: '0.99915929',
              balance: '0',
              apy: '0.06092843715618721351',
              lstApy: '0',
              grossApy: '0.06092843715618721351',
              borrowMin: '0',
              borrowCap: '30000000',
              totalBorrow: '19184638.549091',
            },
            {
              token: {
                chainId: 137,
                address: '0x1BFD67037B42Cf73acF2047067bd4F2C47D9BfD6',
                decimals: 8,
                symbol: 'WBTC',
                name: '(PoS) Wrapped BTC',
              },
              price: '40636.42',
              balance: '0',
              apy: '0.00316551324720556535',
              lstApy: '0',
              grossApy: '0.00316551324720556535',
              borrowMin: '0',
              borrowCap: '851',
              totalBorrow: '55.72665343',
            },
            {
              token: {
                chainId: 137,
                address: '0x7ceB23fD6bC0adD59E62ac25578270cFf1b9f619',
                decimals: 18,
                symbol: 'WETH',
                name: 'Wrapped Ether',
              },
              price: '2376.94',
              balance: '784.924315223112486966',
              apy: '0.01937228987431741293',
              lstApy: '0',
              grossApy: '0.01937228987431741293',
              borrowMin: '0',
              borrowCap: '14795',
              totalBorrow: '5820.529106739478052516',
            },
            {
              token: {
                chainId: 137,
                address: '0xE0B52e49357Fd4DAf2c15e02058DCE6BC0057db4',
                decimals: 18,
                symbol: 'agEUR',
                name: 'agEUR',
              },
              price: '1.0891',
              balance: '0',
              apy: '0.0406597420785802945',
              lstApy: '0',
              grossApy: '0.0406597420785802945',
              borrowMin: '0',
              borrowCap: '250000',
              totalBorrow: '104651.644538077961492651',
            },
            {
              token: {
                chainId: 137,
                address: '0xfa68FB4628DFF1028CFEc22b4162FCcd0d45efb6',
                decimals: 18,
                symbol: 'MaticX',
                name: 'Liquid Staking Matic (PoS)',
              },
              price: '0.82843552',
              balance: '0',
              apy: '0.00272768858846546169',
              lstApy: '0.0515',
              grossApy: '-0.04877231141153453831',
              borrowMin: '0',
              borrowCap: '5200000',
              totalBorrow: '149268.11379471735321614',
            },
            {
              token: {
                chainId: 137,
                address: '0x0000000000000000000000000000000000001010',
                decimals: 18,
                symbol: 'MATIC',
                name: 'Matic Token',
              },
              price: '0.75568306',
              balance: '0',
              apy: '0.03096049661245912882',
              lstApy: '0',
              grossApy: '0.03096049661245912882',
              borrowMin: '0',
              borrowCap: '67000000',
              totalBorrow: '25254957.480876360192997197',
            },
            {
              token: {
                chainId: 137,
                address: '0x03b54A6e9a984069379fae1a4fC4dBAE93B3bCCD',
                decimals: 18,
                symbol: 'wstETH',
                name: 'Wrapped liquid staked Ether 2.0 (PoS)',
              },
              price: '2744.10223788',
              balance: '0',
              apy: '0.00654465262838166723',
              lstApy: '0.0324',
              grossApy: '-0.02585534737161833277',
              borrowMin: '0',
              borrowCap: '570',
              totalBorrow: '175.819913745285350181',
            },
            {
              token: {
                chainId: 137,
                address: '0x3c499c542cEF5E3811e1192ce70d8cC03d5c3359',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD Coin',
              },
              price: '1.00004923',
              balance: '0',
              apy: '0.06156365274477894862',
              lstApy: '0',
              grossApy: '0.06156365274477894862',
              borrowMin: '0',
              borrowCap: '45000000',
              totalBorrow: '6445475.56502',
            },
          ],
        },
      },
      {
        chainId: common.ChainId.base,
        account: '0xb463c4d7c574bd0a05a1320186378dd6a7aeaa33',
        blockTag: 9379220,
        expected: {
          chainId: 8453,
          protocolId: 'aave-v3',
          marketId: 'base',
          utilization: '0.42442165088895282495',
          healthRate: '2.44450300267894474791',
          netAPY: '-0.07592011168843818716',
          totalSupplyUSD: '541397.50906174458400782400112157',
          totalBorrowUSD: '183824.65966652194666',
          supplies: [
            {
              token: {
                chainId: 8453,
                address: '0x0000000000000000000000000000000000000000',
                decimals: 18,
                symbol: 'ETH',
                name: 'Ethereum',
              },
              price: '2525.91577221',
              balance: '214.337118845439391417',
              apy: '0.01440191679302199353',
              lstApy: '0',
              grossApy: '0.01440191679302199353',
              usageAsCollateralEnabled: true,
              ltv: '0.8',
              liquidationThreshold: '0.83',
              isNotCollateral: false,
              supplyCap: '5000',
              totalSupply: '1745.727184670623364007',
            },
            {
              token: {
                chainId: 8453,
                address: '0x2Ae3F1Ec7F1F5012CFEab0185bfc7aa3cf0DEc22',
                decimals: 18,
                symbol: 'cbETH',
                name: 'Coinbase Wrapped Staked ETH',
              },
              price: '2665.89001728',
              balance: '0',
              apy: '0.00007391699036251399',
              lstApy: '0.0274',
              grossApy: '0.02747391699036251399',
              usageAsCollateralEnabled: true,
              ltv: '0.67',
              liquidationThreshold: '0.74',
              isNotCollateral: false,
              supplyCap: '2000',
              totalSupply: '1589.0232509603078062',
            },
            {
              token: {
                chainId: 8453,
                address: '0xd9aAEc86B65D86f6A7B5B1b0c42FFA531710b6CA',
                decimals: 6,
                symbol: 'USDbC',
                name: 'USD Base Coin',
              },
              price: '1.00008538',
              balance: '0',
              apy: '0.13554683067245332856',
              lstApy: '0',
              grossApy: '0.13554683067245332856',
              usageAsCollateralEnabled: true,
              ltv: '0.77',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
              supplyCap: '2000000',
              totalSupply: '1052005.764467',
            },
            {
              token: {
                chainId: 8453,
                address: '0xc1CBa3fCea344f92D9239c08C0568f6F2F0ee452',
                decimals: 18,
                symbol: 'wstETH',
                name: 'Wrapped liquid staked Ether 2.0',
              },
              price: '2914.63646283',
              balance: '0',
              apy: '0.00168948309676120355',
              lstApy: '0.0324',
              grossApy: '0.03408948309676120355',
              usageAsCollateralEnabled: true,
              ltv: '0.71',
              liquidationThreshold: '0.76',
              isNotCollateral: false,
              supplyCap: '4000',
              totalSupply: '87.724754241897923625',
            },
            {
              token: {
                chainId: 8453,
                address: '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD Coin',
              },
              price: '1.00008538',
              balance: '0',
              apy: '0.12777108008277289166',
              lstApy: '0',
              grossApy: '0.12777108008277289166',
              usageAsCollateralEnabled: true,
              ltv: '0.77',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
              supplyCap: '10000000',
              totalSupply: '784870.386249',
            },
          ],
          borrows: [
            {
              token: {
                chainId: 8453,
                address: '0x0000000000000000000000000000000000000000',
                decimals: 18,
                symbol: 'ETH',
                name: 'Ethereum',
              },
              price: '2525.91577221',
              balance: '0',
              apy: '0.02867120034317137727',
              lstApy: '0',
              grossApy: '0.02867120034317137727',
              borrowMin: '0',
              borrowCap: '4000',
              totalBorrow: '1038.941322491268291756',
            },
            {
              token: {
                chainId: 8453,
                address: '0x2Ae3F1Ec7F1F5012CFEab0185bfc7aa3cf0DEc22',
                decimals: 18,
                symbol: 'cbETH',
                name: 'Coinbase Wrapped Staked ETH',
              },
              price: '2665.89001728',
              balance: '0',
              apy: '0.00368465049021125237',
              lstApy: '0.0274',
              grossApy: '-0.02371534950978874763',
              borrowMin: '0',
              borrowCap: '200',
              totalBorrow: '37.570094282390615514',
            },
            {
              token: {
                chainId: 8453,
                address: '0xd9aAEc86B65D86f6A7B5B1b0c42FFA531710b6CA',
                decimals: 6,
                symbol: 'USDbC',
                name: 'USD Base Coin',
              },
              price: '1.00008538',
              balance: '183808.966057',
              apy: '0.1900949122043119091',
              lstApy: '0',
              grossApy: '0.1900949122043119091',
              borrowMin: '0',
              borrowCap: '2000000',
              totalBorrow: '960819.763785',
            },
            {
              token: {
                chainId: 8453,
                address: '0xc1CBa3fCea344f92D9239c08C0568f6F2F0ee452',
                decimals: 18,
                symbol: 'wstETH',
                name: 'Wrapped liquid staked Ether 2.0',
              },
              price: '2914.63646283',
              balance: '0',
              apy: '0.01773165006496342213',
              lstApy: '0.0324',
              grossApy: '-0.01466834993503657787',
              borrowMin: '0',
              borrowCap: '400',
              totalBorrow: '9.912686865308029383',
            },
            {
              token: {
                chainId: 8453,
                address: '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD Coin',
              },
              price: '1.00008538',
              balance: '0',
              apy: '0.15733288326841973815',
              lstApy: '0',
              grossApy: '0.15733288326841973815',
              borrowMin: '0',
              borrowCap: '9000000',
              totalBorrow: '717854.058762',
            },
          ],
        },
      },
      {
        chainId: common.ChainId.arbitrum,
        account: '0xccFa0530B9d52f970d1A2dAEa670ce58E4176389',
        blockTag: 160658642,
        expected: {
          chainId: 42161,
          protocolId: 'aave-v3',
          marketId: 'arbitrum',
          utilization: '1',
          healthRate: '0.91283015658571094827',
          netAPY: '0.05772875963527347313',
          totalSupplyUSD: '9567824.24670337643165871963088905',
          totalBorrowUSD: '8280380.6385705752091152379413338',
          supplies: [
            {
              token: {
                chainId: 42161,
                address: '0xDA10009cBd5D07dd0CeCc66161FC93D7c9000da1',
                decimals: 18,
                symbol: 'DAI',
                name: 'Dai Stablecoin',
              },
              price: '1.00005605',
              balance: '0',
              apy: '0.04524455173985258882',
              lstApy: '0',
              grossApy: '0.04524455173985258882',
              usageAsCollateralEnabled: true,
              ltv: '0.77',
              liquidationThreshold: '0.82',
              isNotCollateral: false,
              supplyCap: '50000000',
              totalSupply: '5802799.486305298865279603',
            },
            {
              token: {
                chainId: 42161,
                address: '0xD22a58f79e9481D1a88e00c343885A588b34b68B',
                decimals: 2,
                symbol: 'EURS',
                name: 'STASIS EURS Token',
              },
              price: '1.08955',
              balance: '0',
              apy: '0.02216750558908961218',
              lstApy: '0',
              grossApy: '0.02216750558908961218',
              usageAsCollateralEnabled: false,
              ltv: '0.65',
              liquidationThreshold: '0.7',
              isNotCollateral: false,
              supplyCap: '65000',
              totalSupply: '43653.6',
            },
            {
              token: {
                chainId: 42161,
                address: '0xf97f4df75117a78c1A5a0DBb814Af92458539FB4',
                decimals: 18,
                symbol: 'LINK',
                name: 'ChainLink Token',
              },
              price: '14.48570799',
              balance: '0',
              apy: '0.00110844637730505253',
              lstApy: '0',
              grossApy: '0.00110844637730505253',
              usageAsCollateralEnabled: true,
              ltv: '0.7',
              liquidationThreshold: '0.775',
              isNotCollateral: false,
              supplyCap: '1575000',
              totalSupply: '1187017.315624191844183612',
            },
            {
              token: {
                chainId: 42161,
                address: '0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9',
                decimals: 6,
                symbol: 'USDT',
                name: 'Tether USD',
              },
              price: '0.99993522',
              balance: '0',
              apy: '0.06013539446848360279',
              lstApy: '0',
              grossApy: '0.06013539446848360279',
              usageAsCollateralEnabled: false,
              ltv: '0.75',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
              supplyCap: '50000000',
              totalSupply: '16461226.369026',
            },
            {
              token: {
                chainId: 42161,
                address: '0x2f2a2543B76A4166549F7aaB2e75Bef0aefC5B0f',
                decimals: 8,
                symbol: 'WBTC',
                name: 'Wrapped BTC',
              },
              price: '42331.442229',
              balance: '0',
              apy: '0.00116524608978289489',
              lstApy: '0',
              grossApy: '0.00116524608978289489',
              usageAsCollateralEnabled: true,
              ltv: '0.73',
              liquidationThreshold: '0.78',
              isNotCollateral: false,
              supplyCap: '4200',
              totalSupply: '1607.39929695',
            },
            {
              token: {
                chainId: 42161,
                address: '0xFF970A61A04b1cA14834A43f5dE4533eBDDB5CC8',
                decimals: 6,
                symbol: 'USDC.e',
                name: 'USD Coin (Arb1)',
              },
              price: '1.00023692',
              balance: '0',
              apy: '0.06185280657302697309',
              lstApy: '0',
              grossApy: '0.06185280657302697309',
              usageAsCollateralEnabled: true,
              ltv: '0.81',
              liquidationThreshold: '0.86',
              isNotCollateral: false,
              supplyCap: '150000000',
              totalSupply: '25860203.010173',
            },
            {
              token: {
                chainId: 42161,
                address: '0xba5DdD1f9d7F570dc94a51479a000E3BCE967196',
                decimals: 18,
                symbol: 'AAVE',
                name: 'Aave Token',
              },
              price: '106.7851',
              balance: '0',
              apy: '0',
              lstApy: '0',
              grossApy: '0',
              usageAsCollateralEnabled: true,
              ltv: '0.5',
              liquidationThreshold: '0.65',
              isNotCollateral: false,
              supplyCap: '1850',
              totalSupply: '1846.293710151185479161',
            },
            {
              token: {
                chainId: 42161,
                address: '0x0000000000000000000000000000000000000000',
                decimals: 18,
                symbol: 'ETH',
                name: 'Ethereum',
              },
              price: '2244.01978972',
              balance: '0',
              apy: '0.0163833672945417932',
              lstApy: '0',
              grossApy: '0.0163833672945417932',
              usageAsCollateralEnabled: true,
              ltv: '0.825',
              liquidationThreshold: '0.85',
              isNotCollateral: false,
              supplyCap: '70000',
              totalSupply: '40893.643339569809416826',
            },
            {
              token: {
                chainId: 42161,
                address: '0x93b346b6BC2548dA6A1E7d98E9a421B42541425b',
                decimals: 18,
                symbol: 'LUSD',
                name: 'LUSD Stablecoin',
              },
              price: '0.99912831',
              balance: '0',
              apy: '0.03498368035229415632',
              lstApy: '0',
              grossApy: '0.03498368035229415632',
              usageAsCollateralEnabled: false,
              ltv: '0',
              liquidationThreshold: '0',
              isNotCollateral: false,
              supplyCap: '2200000',
              totalSupply: '2200837.638582608281988083',
            },
            {
              token: {
                chainId: 42161,
                address: '0xaf88d065e77c8cC2239327C5EDb3A432268e5831',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD Coin',
              },
              price: '1.00023692',
              balance: '0',
              apy: '0.04104600900636756498',
              lstApy: '0',
              grossApy: '0.04104600900636756498',
              usageAsCollateralEnabled: true,
              ltv: '0.81',
              liquidationThreshold: '0.86',
              isNotCollateral: false,
              supplyCap: '64000000',
              totalSupply: '41776016.125961',
            },
            {
              token: {
                chainId: 42161,
                address: '0xEC70Dcb4A1EFa46b8F2D97C310C9c4790ba5ffA8',
                decimals: 18,
                symbol: 'rETH',
                name: 'Rocket Pool ETH',
              },
              price: '2451.95357364',
              balance: '0',
              apy: '0.00431178472420963324',
              lstApy: '0.0275',
              grossApy: '0.03181178472420963324',
              usageAsCollateralEnabled: true,
              ltv: '0.67',
              liquidationThreshold: '0.74',
              isNotCollateral: false,
              supplyCap: '3400',
              totalSupply: '2679.658858304461309848',
            },
            {
              token: {
                chainId: 42161,
                address: '0x5979D7b546E38E414F7E9822514be443A4800529',
                decimals: 18,
                symbol: 'wstETH',
                name: 'Wrapped liquid staked Ether 2.0',
              },
              price: '2581.17753165',
              balance: '3706.767213562102614957',
              apy: '0.00001625302636224031',
              lstApy: '0.0324',
              grossApy: '0.03241625302636224031',
              usageAsCollateralEnabled: true,
              ltv: '0.7',
              liquidationThreshold: '0.79',
              isNotCollateral: false,
              supplyCap: '55000',
              totalSupply: '42396.232933917579044524',
            },
            {
              token: {
                chainId: 42161,
                address: '0x912CE59144191C1204E64559FE8253a0e49E6548',
                decimals: 18,
                symbol: 'ARB',
                name: 'Arbitrum',
              },
              price: '1.12526332',
              balance: '0',
              apy: '0.00308609822196671461',
              lstApy: '0',
              grossApy: '0.00308609822196671461',
              usageAsCollateralEnabled: false,
              ltv: '0.5',
              liquidationThreshold: '0.6',
              isNotCollateral: false,
              supplyCap: '20000000',
              totalSupply: '12437267.378689126926661304',
            },
            {
              token: {
                chainId: 42161,
                address: '0x17FC002b466eEc40DaE837Fc4bE5c67993ddBd6F',
                decimals: 18,
                symbol: 'FRAX',
                name: 'Frax',
              },
              price: '0.99916755',
              balance: '0',
              apy: '0.03945025997042045639',
              lstApy: '0',
              grossApy: '0.03945025997042045639',
              usageAsCollateralEnabled: false,
              ltv: '0.7',
              liquidationThreshold: '0.75',
              isNotCollateral: false,
              supplyCap: '7000000',
              totalSupply: '157217.458596802715259512',
            },
          ],
          borrows: [
            {
              token: {
                chainId: 42161,
                address: '0xDA10009cBd5D07dd0CeCc66161FC93D7c9000da1',
                decimals: 18,
                symbol: 'DAI',
                name: 'Dai Stablecoin',
              },
              price: '1.00005605',
              balance: '0',
              apy: '0.05127426226771750666',
              lstApy: '0',
              grossApy: '0.05127426226771750666',
              borrowMin: '0',
              borrowCap: '30000000',
              totalBorrow: '4369438.497378255741913274',
            },
            {
              token: {
                chainId: 42161,
                address: '0xD22a58f79e9481D1a88e00c343885A588b34b68B',
                decimals: 2,
                symbol: 'EURS',
                name: 'STASIS EURS Token',
              },
              price: '1.08955',
              balance: '0',
              apy: '0.04137370221553932538',
              lstApy: '0',
              grossApy: '0.04137370221553932538',
              borrowMin: '0',
              borrowCap: '65000',
              totalBorrow: '16846.11',
            },
            {
              token: {
                chainId: 42161,
                address: '0xf97f4df75117a78c1A5a0DBb814Af92458539FB4',
                decimals: 18,
                symbol: 'LINK',
                name: 'ChainLink Token',
              },
              price: '14.48570799',
              balance: '0',
              apy: '0.0147851512314853723',
              lstApy: '0',
              grossApy: '0.0147851512314853723',
              borrowMin: '0',
              borrowCap: '484490',
              totalBorrow: '111997.089294151734948866',
            },
            {
              token: {
                chainId: 42161,
                address: '0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9',
                decimals: 6,
                symbol: 'USDT',
                name: 'Tether USD',
              },
              price: '0.99993522',
              balance: '0',
              apy: '0.07907546292614059152',
              lstApy: '0',
              grossApy: '0.07907546292614059152',
              borrowMin: '0',
              borrowCap: '35000000',
              totalBorrow: '11594401.183991',
            },
            {
              token: {
                chainId: 42161,
                address: '0x2f2a2543B76A4166549F7aaB2e75Bef0aefC5B0f',
                decimals: 8,
                symbol: 'WBTC',
                name: 'Wrapped BTC',
              },
              price: '42331.442229',
              balance: '0',
              apy: '0.01144019864042859424',
              lstApy: '0',
              grossApy: '0.01144019864042859424',
              borrowMin: '0',
              borrowCap: '1115',
              totalBorrow: '205.70168357',
            },
            {
              token: {
                chainId: 42161,
                address: '0xFF970A61A04b1cA14834A43f5dE4533eBDDB5CC8',
                decimals: 6,
                symbol: 'USDC.e',
                name: 'USD Coin (Arb1)',
              },
              price: '1.00023692',
              balance: '0',
              apy: '0.08567990769323201746',
              lstApy: '0',
              grossApy: '0.08567990769323201746',
              borrowMin: '0',
              borrowCap: '100000000',
              totalBorrow: '16782611.508418',
            },
            {
              token: {
                chainId: 42161,
                address: '0x0000000000000000000000000000000000000000',
                decimals: 18,
                symbol: 'ETH',
                name: 'Ethereum',
              },
              price: '2244.01978972',
              balance: '3689.976655510586505415',
              apy: '0.02848063384870475934',
              lstApy: '0',
              grossApy: '0.02848063384870475934',
              borrowMin: '0',
              borrowCap: '40000',
              totalBorrow: '27840.229024617206753808',
            },
            {
              token: {
                chainId: 42161,
                address: '0x93b346b6BC2548dA6A1E7d98E9a421B42541425b',
                decimals: 18,
                symbol: 'LUSD',
                name: 'LUSD Stablecoin',
              },
              price: '0.99912831',
              balance: '0',
              apy: '0.05007970601435907876',
              lstApy: '0',
              grossApy: '0.05007970601435907876',
              borrowMin: '0',
              borrowCap: '1800000',
              totalBorrow: '1720772.406066544886785171',
            },
            {
              token: {
                chainId: 42161,
                address: '0xaf88d065e77c8cC2239327C5EDb3A432268e5831',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD Coin',
              },
              price: '1.00023692',
              balance: '0',
              apy: '0.05109299271756908264',
              lstApy: '0',
              grossApy: '0.05109299271756908264',
              borrowMin: '0',
              borrowCap: '60000000',
              totalBorrow: '37471648.392778',
            },
            {
              token: {
                chainId: 42161,
                address: '0xEC70Dcb4A1EFa46b8F2D97C310C9c4790ba5ffA8',
                decimals: 18,
                symbol: 'rETH',
                name: 'Rocket Pool ETH',
              },
              price: '2451.95357364',
              balance: '0',
              apy: '0.02845784592439778344',
              lstApy: '0.0275',
              grossApy: '0.00095784592439778344',
              borrowMin: '0',
              borrowCap: '1360',
              totalBorrow: '483.382423361694526377',
            },
            {
              token: {
                chainId: 42161,
                address: '0x5979D7b546E38E414F7E9822514be443A4800529',
                decimals: 18,
                symbol: 'wstETH',
                name: 'Wrapped liquid staked Ether 2.0',
              },
              price: '2581.17753165',
              balance: '0',
              apy: '0.00311888292011425678',
              lstApy: '0.0324',
              grossApy: '-0.02928111707988574322',
              borrowMin: '0',
              borrowCap: '2400',
              totalBorrow: '260.325431380454616496',
            },
            {
              token: {
                chainId: 42161,
                address: '0x912CE59144191C1204E64559FE8253a0e49E6548',
                decimals: 18,
                symbol: 'ARB',
                name: 'Arbitrum',
              },
              price: '1.12526332',
              balance: '0',
              apy: '0.02477958780886026724',
              lstApy: '0',
              grossApy: '0.02477958780886026724',
              borrowMin: '0',
              borrowCap: '16500000',
              totalBorrow: '1957080.132272229872371464',
            },
            {
              token: {
                chainId: 42161,
                address: '0x17FC002b466eEc40DaE837Fc4bE5c67993ddBd6F',
                decimals: 18,
                symbol: 'FRAX',
                name: 'Frax',
              },
              price: '0.99916755',
              balance: '0',
              apy: '0.05008508530654595292',
              lstApy: '0',
              grossApy: '0.05008508530654595292',
              borrowMin: '0',
              borrowCap: '5500000',
              totalBorrow: '138303.941574883442287013',
            },
          ],
        },
      },
      {
        chainId: common.ChainId.optimism,
        account: '0x7b9CDCC6831796fCcB21b5f7241e2cEd813Efe92',
        blockTag: 113571686,
        expected: {
          chainId: 10,
          protocolId: 'aave-v3',
          marketId: 'optimism',
          utilization: '1',
          healthRate: '0.92207500097807484087',
          netAPY: '0.05171424874509312398',
          totalSupplyUSD: '7129880.78864845658706943890608614',
          totalBorrowUSD: '6185944.3373569923772633536008896',
          supplies: [
            {
              token: {
                chainId: 10,
                address: '0xDA10009cBd5D07dd0CeCc66161FC93D7c9000da1',
                decimals: 18,
                symbol: 'DAI',
                name: 'Dai Stablecoin',
              },
              price: '1.00002282',
              balance: '0',
              apy: '0.08029571572141981405',
              lstApy: '0',
              grossApy: '0.08029571572141981405',
              usageAsCollateralEnabled: true,
              ltv: '0.78',
              liquidationThreshold: '0.83',
              isNotCollateral: false,
              supplyCap: '25000000',
              totalSupply: '2585801.985637176281924099',
            },
            {
              token: {
                chainId: 10,
                address: '0x350a791Bfc2C21F9Ed5d10980Dad2e2638ffa7f6',
                decimals: 18,
                symbol: 'LINK',
                name: 'ChainLink Token',
              },
              price: '14.64277',
              balance: '0',
              apy: '0.00031629974871617226',
              lstApy: '0',
              grossApy: '0.00031629974871617226',
              usageAsCollateralEnabled: true,
              ltv: '0.7',
              liquidationThreshold: '0.75',
              isNotCollateral: false,
              supplyCap: '210000',
              totalSupply: '204117.456638770661150949',
            },
            {
              token: {
                chainId: 10,
                address: '0x8c6f28f2F1A3C87F0f938b96d27520d9751ec8d9',
                decimals: 18,
                symbol: 'sUSD',
                name: 'Synth sUSD',
              },
              price: '0.99889539',
              balance: '0',
              apy: '0.02912717500053536556',
              lstApy: '0',
              grossApy: '0.02912717500053536556',
              usageAsCollateralEnabled: true,
              ltv: '0.6',
              liquidationThreshold: '0.75',
              isNotCollateral: false,
              supplyCap: '20000000',
              totalSupply: '6281520.249974342500361567',
            },
            {
              token: {
                chainId: 10,
                address: '0x7F5c764cBc14f9669B88837ca1490cCa17c31607',
                decimals: 6,
                symbol: 'USDC.e',
                name: 'USD Coin (Bridged from Ethereum)',
              },
              price: '1.00000221',
              balance: '0',
              apy: '0.05478173148480717051',
              lstApy: '0',
              grossApy: '0.05478173148480717051',
              usageAsCollateralEnabled: true,
              ltv: '0.8',
              liquidationThreshold: '0.85',
              isNotCollateral: false,
              supplyCap: '25000000',
              totalSupply: '19231384.088047',
            },
            {
              token: {
                chainId: 10,
                address: '0x68f180fcCe6836688e9084f035309E29Bf0A2095',
                decimals: 8,
                symbol: 'WBTC',
                name: 'Wrapped BTC',
              },
              price: '42472.674242',
              balance: '0',
              apy: '0.0004181808344552407',
              lstApy: '0',
              grossApy: '0.0004181808344552407',
              usageAsCollateralEnabled: true,
              ltv: '0.73',
              liquidationThreshold: '0.78',
              isNotCollateral: false,
              supplyCap: '1200',
              totalSupply: '509.84485152',
            },
            {
              token: {
                chainId: 10,
                address: '0x94b008aA00579c1307B0EF2c499aD98a8ce58e58',
                decimals: 6,
                symbol: 'USDT',
                name: 'Tether USD',
              },
              price: '0.99976223',
              balance: '0',
              apy: '0.1155507491940290518',
              lstApy: '0',
              grossApy: '0.1155507491940290518',
              usageAsCollateralEnabled: false,
              ltv: '0.75',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
              supplyCap: '25000000',
              totalSupply: '5923879.53636',
            },
            {
              token: {
                chainId: 10,
                address: '0x76FB31fb4af56892A25e32cFC43De717950c9278',
                decimals: 18,
                symbol: 'AAVE',
                name: 'Aave Token',
              },
              price: '107.3828',
              balance: '0',
              apy: '0',
              lstApy: '0',
              grossApy: '0',
              usageAsCollateralEnabled: true,
              ltv: '0.5',
              liquidationThreshold: '0.65',
              isNotCollateral: false,
              supplyCap: '45000',
              totalSupply: '4337.076855148333607792',
            },
            {
              token: {
                chainId: 10,
                address: '0x0000000000000000000000000000000000000000',
                decimals: 18,
                symbol: 'ETH',
                name: 'Ethereum',
              },
              price: '2253.0864232',
              balance: '0',
              apy: '0.01759972129931819265',
              lstApy: '0',
              grossApy: '0.01759972129931819265',
              usageAsCollateralEnabled: true,
              ltv: '0.8',
              liquidationThreshold: '0.825',
              isNotCollateral: false,
              supplyCap: '35900',
              totalSupply: '17312.435028802928656026',
            },
            {
              token: {
                chainId: 10,
                address: '0x1F32b1c2345538c0c6f582fCB022739c4A194Ebb',
                decimals: 18,
                symbol: 'wstETH',
                name: 'Wrapped liquid staked Ether 2.0',
              },
              price: '2591.60640163',
              balance: '2751.143377390985329378',
              apy: '0.00006280656369123281',
              lstApy: '0.0324',
              grossApy: '0.03246280656369123281',
              usageAsCollateralEnabled: true,
              ltv: '0.71',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
              supplyCap: '34500',
              totalSupply: '19470.083054554338894097',
            },
            {
              token: {
                chainId: 10,
                address: '0x4200000000000000000000000000000000000042',
                decimals: 18,
                symbol: 'OP',
                name: 'Optimism',
              },
              price: '2.18156955',
              balance: '0',
              apy: '0.00033439753394630285',
              lstApy: '0',
              grossApy: '0.00033439753394630285',
              usageAsCollateralEnabled: true,
              ltv: '0.3',
              liquidationThreshold: '0.4',
              isNotCollateral: false,
              supplyCap: '10000000',
              totalSupply: '4580520.485436663242117524',
            },
            {
              token: {
                chainId: 10,
                address: '0x9Bcef72be871e61ED4fBbc7630889beE758eb81D',
                decimals: 18,
                symbol: 'rETH',
                name: 'Rocket Pool ETH',
              },
              price: '2461.68955583',
              balance: '0',
              apy: '0.00006157040312459567',
              lstApy: '0.0275',
              grossApy: '0.02756157040312459567',
              usageAsCollateralEnabled: true,
              ltv: '0.67',
              liquidationThreshold: '0.74',
              isNotCollateral: false,
              supplyCap: '6000',
              totalSupply: '576.352858191538500054',
            },
            {
              token: {
                chainId: 10,
                address: '0xc40F949F8a4e094D1b49a23ea9241D289B7b2819',
                decimals: 18,
                symbol: 'LUSD',
                name: 'LUSD Stablecoin',
              },
              price: '0.99939599',
              balance: '0',
              apy: '0.10086907307902019713',
              lstApy: '0',
              grossApy: '0.10086907307902019713',
              usageAsCollateralEnabled: false,
              ltv: '0',
              liquidationThreshold: '0',
              isNotCollateral: false,
              supplyCap: '3000000',
              totalSupply: '132938.933841075547543289',
            },
            {
              token: {
                chainId: 10,
                address: '0x0b2C639c533813f4Aa9D7837CAf62653d097Ff85',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD Coin',
              },
              price: '1.00000221',
              balance: '0',
              apy: '0.14230125938934205202',
              lstApy: '0',
              grossApy: '0.14230125938934205202',
              usageAsCollateralEnabled: true,
              ltv: '0.8',
              liquidationThreshold: '0.85',
              isNotCollateral: false,
              supplyCap: '25000000',
              totalSupply: '1599300.085799',
            },
          ],
          borrows: [
            {
              token: {
                chainId: 10,
                address: '0xDA10009cBd5D07dd0CeCc66161FC93D7c9000da1',
                decimals: 18,
                symbol: 'DAI',
                name: 'Dai Stablecoin',
              },
              price: '1.00002282',
              balance: '0',
              apy: '0.10214629003321339804',
              lstApy: '0',
              grossApy: '0.10214629003321339804',
              borrowMin: '0',
              borrowCap: '16000000',
              totalBorrow: '2198806.672716259158323742',
            },
            {
              token: {
                chainId: 10,
                address: '0x350a791Bfc2C21F9Ed5d10980Dad2e2638ffa7f6',
                decimals: 18,
                symbol: 'LINK',
                name: 'ChainLink Token',
              },
              price: '14.64277',
              balance: '0',
              apy: '0.00787257455741770749',
              lstApy: '0',
              grossApy: '0.00787257455741770749',
              borrowMin: '0',
              borrowCap: '84000',
              totalBorrow: '10289.83331713380027938',
            },
            {
              token: {
                chainId: 10,
                address: '0x8c6f28f2F1A3C87F0f938b96d27520d9751ec8d9',
                decimals: 18,
                symbol: 'sUSD',
                name: 'Synth sUSD',
              },
              price: '0.99889539',
              balance: '0',
              apy: '0.04566415286176893977',
              lstApy: '0',
              grossApy: '0.04566415286176893977',
              borrowMin: '0',
              borrowCap: '13000000',
              totalBorrow: '4487774.83306114914761885',
            },
            {
              token: {
                chainId: 10,
                address: '0x7F5c764cBc14f9669B88837ca1490cCa17c31607',
                decimals: 6,
                symbol: 'USDC.e',
                name: 'USD Coin (Bridged from Ethereum)',
              },
              price: '1.00000221',
              balance: '0',
              apy: '0.078596936193978136',
              lstApy: '0',
              grossApy: '0.078596936193978136',
              borrowMin: '0',
              borrowCap: '20000000',
              totalBorrow: '16065042.364108',
            },
            {
              token: {
                chainId: 10,
                address: '0x68f180fcCe6836688e9084f035309E29Bf0A2095',
                decimals: 8,
                symbol: 'WBTC',
                name: 'Wrapped BTC',
              },
              price: '42472.674242',
              balance: '0',
              apy: '0.00683905789364176548',
              lstApy: '0',
              grossApy: '0.00683905789364176548',
              borrowMin: '0',
              borrowCap: '250',
              totalBorrow: '39.09363874',
            },
            {
              token: {
                chainId: 10,
                address: '0x94b008aA00579c1307B0EF2c499aD98a8ce58e58',
                decimals: 6,
                symbol: 'USDT',
                name: 'Tether USD',
              },
              price: '0.99976223',
              balance: '0',
              apy: '0.14946330461076310507',
              lstApy: '0',
              grossApy: '0.14946330461076310507',
              borrowMin: '0',
              borrowCap: '16000000',
              totalBorrow: '5008876.169012',
            },
            {
              token: {
                chainId: 10,
                address: '0x0000000000000000000000000000000000000000',
                decimals: 18,
                symbol: 'ETH',
                name: 'Ethereum',
              },
              price: '2253.0864232',
              balance: '2745.542414023895564728',
              apy: '0.02952515678478624892',
              lstApy: '0',
              grossApy: '0.02952515678478624892',
              borrowMin: '0',
              borrowCap: '19745',
              totalBorrow: '12212.252255057979726948',
            },
            {
              token: {
                chainId: 10,
                address: '0x1F32b1c2345538c0c6f582fCB022739c4A194Ebb',
                decimals: 18,
                symbol: 'wstETH',
                name: 'Wrapped liquid staked Ether 2.0',
              },
              price: '2591.60640163',
              balance: '0',
              apy: '0.00425087768018463859',
              lstApy: '0.0324',
              grossApy: '-0.02814912231981536141',
              borrowMin: '0',
              borrowCap: '1500',
              totalBorrow: '339.143213014800666487',
            },
            {
              token: {
                chainId: 10,
                address: '0x9Bcef72be871e61ED4fBbc7630889beE758eb81D',
                decimals: 18,
                symbol: 'rETH',
                name: 'Rocket Pool ETH',
              },
              price: '2461.68955583',
              balance: '0',
              apy: '0.00336234068910269273',
              lstApy: '0.0275',
              grossApy: '-0.02413765931089730727',
              borrowMin: '0',
              borrowCap: '720',
              totalBorrow: '12.437007329155728376',
            },
            {
              token: {
                chainId: 10,
                address: '0xc40F949F8a4e094D1b49a23ea9241D289B7b2819',
                decimals: 18,
                symbol: 'LUSD',
                name: 'LUSD Stablecoin',
              },
              price: '0.99939599',
              balance: '0',
              apy: '0.13934785921335083626',
              lstApy: '0',
              grossApy: '0.13934785921335083626',
              borrowMin: '0',
              borrowCap: '1210000',
              totalBorrow: '108812.761681151745153015',
            },
            {
              token: {
                chainId: 10,
                address: '0x0b2C639c533813f4Aa9D7837CAf62653d097Ff85',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD Coin',
              },
              price: '1.00000221',
              balance: '0',
              apy: '0.17412319034353027801',
              lstApy: '0',
              grossApy: '0.17412319034353027801',
              borrowMin: '0',
              borrowCap: '20000000',
              totalBorrow: '1473203.598876',
            },
          ],
        },
      },
      {
        chainId: common.ChainId.avalanche,
        account: '0xf567361ff0bCDcAd1252c8E2Fb8e5d4a9bB4e266',
        blockTag: 39128043,
        expected: {
          chainId: 43114,
          protocolId: 'aave-v3',
          marketId: 'avalanche',
          utilization: '0.75992353673586861559',
          healthRate: '1.40587165388572483349',
          netAPY: '0.00470661909745758133',
          totalSupplyUSD: '2096544.2124297834856',
          totalBorrowUSD: '1135610.1168707633355002636817958',
          supplies: [
            {
              token: {
                chainId: 43114,
                address: '0xD24C2Ad096400B6FBcd2ad8B24E7acBc21A1da64',
                decimals: 18,
                symbol: 'FRAX',
                name: 'Frax',
              },
              price: '0.99923705',
              balance: '0',
              apy: '0.02405727775538844641',
              lstApy: '0',
              grossApy: '0.02405727775538844641',
              usageAsCollateralEnabled: false,
              ltv: '0.75',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
              supplyCap: '1500000',
              totalSupply: '14344.725459106802371348',
            },
            {
              token: {
                chainId: 43114,
                address: '0xB97EF9Ef8734C71904D8002F8b6Bc66Dd9c48a6E',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD Coin',
              },
              price: '1.0002524',
              balance: '214291.813654',
              apy: '0.11245319633282759276',
              lstApy: '0',
              grossApy: '0.11245319633282759276',
              usageAsCollateralEnabled: true,
              ltv: '0.825',
              liquidationThreshold: '0.8625',
              isNotCollateral: false,
              supplyCap: '170000000',
              totalSupply: '35596545.103386',
            },
            {
              token: {
                chainId: 43114,
                address: '0x9702230A8Ea53601f5cD2dc00fDBc13d4dF4A8c7',
                decimals: 6,
                symbol: 'USDt',
                name: 'TetherToken',
              },
              price: '0.9998278',
              balance: '0',
              apy: '0.10990662301331500012',
              lstApy: '0',
              grossApy: '0.10990662301331500012',
              usageAsCollateralEnabled: true,
              ltv: '0.75',
              liquidationThreshold: '0.81',
              isNotCollateral: false,
              supplyCap: '100000000',
              totalSupply: '18138699.03353',
            },
            {
              token: {
                chainId: 43114,
                address: '0x152b9d0FdC40C096757F570A51E494bd4b943E50',
                decimals: 8,
                symbol: 'BTC.b',
                name: 'Bitcoin',
              },
              price: '42540.80155',
              balance: '44.24454272',
              apy: '0.00018399211774211181',
              lstApy: '0',
              grossApy: '0.00018399211774211181',
              usageAsCollateralEnabled: true,
              ltv: '0.7',
              liquidationThreshold: '0.75',
              isNotCollateral: false,
              supplyCap: '3000',
              totalSupply: '1130.70421247',
            },
            {
              token: {
                chainId: 43114,
                address: '0xd586E7F844cEa2F87f50152665BCbc2C279D8d70',
                decimals: 18,
                symbol: 'DAI.e',
                name: 'Dai Stablecoin',
              },
              price: '1',
              balance: '0',
              apy: '0.04475631358170004319',
              lstApy: '0',
              grossApy: '0.04475631358170004319',
              usageAsCollateralEnabled: true,
              ltv: '0.75',
              liquidationThreshold: '0.82',
              isNotCollateral: false,
              supplyCap: '17000000',
              totalSupply: '3901798.540779609997176857',
            },
            {
              token: {
                chainId: 43114,
                address: '0x5947BB275c521040051D82396192181b413227A3',
                decimals: 18,
                symbol: 'LINK.e',
                name: 'Chainlink Token',
              },
              price: '14.58823',
              balance: '0',
              apy: '0.00110636904532698615',
              lstApy: '0',
              grossApy: '0.00110636904532698615',
              usageAsCollateralEnabled: true,
              ltv: '0.56',
              liquidationThreshold: '0.71',
              isNotCollateral: false,
              supplyCap: '440000',
              totalSupply: '203693.157085879217474773',
            },
            {
              token: {
                chainId: 43114,
                address: '0x50b7545627a5162F82A992c33b87aDc75187B218',
                decimals: 8,
                symbol: 'WBTC.e',
                name: 'Wrapped BTC',
              },
              price: '42540.80155',
              balance: '0',
              apy: '0.00008002157304503949',
              lstApy: '0',
              grossApy: '0.00008002157304503949',
              usageAsCollateralEnabled: true,
              ltv: '0.7',
              liquidationThreshold: '0.75',
              isNotCollateral: false,
              supplyCap: '2000',
              totalSupply: '673.8230531',
            },
            {
              token: {
                chainId: 43114,
                address: '0x49D5c2BdFfac6CE2BFdB6640F4F80f226bc10bAB',
                decimals: 18,
                symbol: 'WETH.e',
                name: 'Wrapped Ether',
              },
              price: '2255.12839519',
              balance: '0',
              apy: '0.00230482557632344167',
              lstApy: '0',
              grossApy: '0.00230482557632344167',
              usageAsCollateralEnabled: true,
              ltv: '0.8',
              liquidationThreshold: '0.825',
              isNotCollateral: false,
              supplyCap: '38000',
              totalSupply: '14092.062663932627078843',
            },
            {
              token: {
                chainId: 43114,
                address: '0x2b2C81e08f1Af8835a78Bb2A90AE924ACE0eA4bE',
                decimals: 18,
                symbol: 'sAVAX',
                name: 'Staked AVAX',
              },
              price: '50.1216625',
              balance: '0',
              apy: '0',
              lstApy: '0.0576',
              grossApy: '0.0576',
              usageAsCollateralEnabled: true,
              ltv: '0.3',
              liquidationThreshold: '0.4',
              isNotCollateral: false,
              supplyCap: '2200000',
              totalSupply: '1261669.28668257238781593',
            },
            {
              token: {
                chainId: 43114,
                address: '0x63a72806098Bd3D9520cC43356dD78afe5D386D9',
                decimals: 18,
                symbol: 'AAVE.e',
                name: 'Aave Token',
              },
              price: '107.31447',
              balance: '0',
              apy: '0',
              lstApy: '0',
              grossApy: '0',
              usageAsCollateralEnabled: true,
              ltv: '0.6',
              liquidationThreshold: '0.713',
              isNotCollateral: false,
              supplyCap: '5800',
              totalSupply: '3804.749540939523419669',
            },
            {
              token: {
                chainId: 43114,
                address: '0x0000000000000000000000000000000000000000',
                decimals: 18,
                symbol: 'AVAX',
                name: 'Avalanche',
              },
              price: '44.7',
              balance: '0',
              apy: '0.01601086886712040041',
              lstApy: '0',
              grossApy: '0.01601086886712040041',
              usageAsCollateralEnabled: true,
              ltv: '0.68',
              liquidationThreshold: '0.73',
              isNotCollateral: false,
              supplyCap: '5700000',
              totalSupply: '3018830.056769793051460555',
            },
            {
              token: {
                chainId: 43114,
                address: '0x5c49b268c9841AFF1Cc3B0a418ff5c3442eE3F3b',
                decimals: 18,
                symbol: 'MAI',
                name: 'Mai Stablecoin',
              },
              price: '0.86985096',
              balance: '0',
              apy: '0.0134362920070027044',
              lstApy: '0',
              grossApy: '0.0134362920070027044',
              usageAsCollateralEnabled: false,
              ltv: '0',
              liquidationThreshold: '0.01',
              isNotCollateral: false,
              supplyCap: '20000',
              totalSupply: '15422.625909218799074612',
            },
          ],
          borrows: [
            {
              token: {
                chainId: 43114,
                address: '0xD24C2Ad096400B6FBcd2ad8B24E7acBc21A1da64',
                decimals: 18,
                symbol: 'FRAX',
                name: 'Frax',
              },
              price: '0.99923705',
              balance: '0',
              apy: '0.0390503021725579184',
              lstApy: '0',
              grossApy: '0.0390503021725579184',
              borrowMin: '0',
              borrowCap: '1000000',
              totalBorrow: '9891.288478520892757229',
            },
            {
              token: {
                chainId: 43114,
                address: '0xB97EF9Ef8734C71904D8002F8b6Bc66Dd9c48a6E',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD Coin',
              },
              price: '1.0002524',
              balance: '0',
              apy: '0.14104271614818463309',
              lstApy: '0',
              grossApy: '0.14104271614818463309',
              borrowMin: '0',
              borrowCap: '90000000',
              totalBorrow: '31584636.255854',
            },
            {
              token: {
                chainId: 43114,
                address: '0x9702230A8Ea53601f5cD2dc00fDBc13d4dF4A8c7',
                decimals: 6,
                symbol: 'USDt',
                name: 'TetherToken',
              },
              price: '0.9998278',
              balance: '0',
              apy: '0.13984284203255391256',
              lstApy: '0',
              grossApy: '0.13984284203255391256',
              borrowMin: '0',
              borrowCap: '80000000',
              totalBorrow: '15730502.202033',
            },
            {
              token: {
                chainId: 43114,
                address: '0x152b9d0FdC40C096757F570A51E494bd4b943E50',
                decimals: 8,
                symbol: 'BTC.b',
                name: 'Bitcoin',
              },
              price: '42540.80155',
              balance: '0',
              apy: '0.00599897178397704241',
              lstApy: '0',
              grossApy: '0.00599897178397704241',
              borrowMin: '0',
              borrowCap: '900',
              totalBorrow: '43.47547942',
            },
            {
              token: {
                chainId: 43114,
                address: '0xd586E7F844cEa2F87f50152665BCbc2C279D8d70',
                decimals: 18,
                symbol: 'DAI.e',
                name: 'Dai Stablecoin',
              },
              price: '1',
              balance: '0',
              apy: '0.05550240589399468333',
              lstApy: '0',
              grossApy: '0.05550240589399468333',
              borrowMin: '0',
              borrowCap: '17000000',
              totalBorrow: '3510006.154146261003561298',
            },
            {
              token: {
                chainId: 43114,
                address: '0x5947BB275c521040051D82396192181b413227A3',
                decimals: 18,
                symbol: 'LINK.e',
                name: 'Chainlink Token',
              },
              price: '14.58823',
              balance: '0',
              apy: '0.0147711962077648869',
              lstApy: '0',
              grossApy: '0.0147711962077648869',
              borrowMin: '0',
              borrowCap: '220000',
              totalBorrow: '19201.044046325368603457',
            },
            {
              token: {
                chainId: 43114,
                address: '0x50b7545627a5162F82A992c33b87aDc75187B218',
                decimals: 8,
                symbol: 'WBTC.e',
                name: 'Wrapped BTC',
              },
              price: '42540.80155',
              balance: '0',
              apy: '0.00298621616953280854',
              lstApy: '0',
              grossApy: '0.00298621616953280854',
              borrowMin: '0',
              borrowCap: '1100',
              totalBorrow: '22.60332888',
            },
            {
              token: {
                chainId: 43114,
                address: '0x49D5c2BdFfac6CE2BFdB6640F4F80f226bc10bAB',
                decimals: 18,
                symbol: 'WETH.e',
                name: 'Wrapped Ether',
              },
              price: '2255.12839519',
              balance: '503.56783201033014682',
              apy: '0.01754778358317233615',
              lstApy: '0',
              grossApy: '0.01754778358317233615',
              borrowMin: '0',
              borrowCap: '20500',
              totalBorrow: '2194.093601314743311969',
            },
            {
              token: {
                chainId: 43114,
                address: '0x0000000000000000000000000000000000000000',
                decimals: 18,
                symbol: 'AVAX',
                name: 'Avalanche',
              },
              price: '44.7',
              balance: '0',
              apy: '0.04424966051329394784',
              lstApy: '0',
              grossApy: '0.04424966051329394784',
              borrowMin: '0',
              borrowCap: '3600000',
              totalBorrow: '1384331.257203353233737012',
            },
            {
              token: {
                chainId: 43114,
                address: '0x5c49b268c9841AFF1Cc3B0a418ff5c3442eE3F3b',
                decimals: 18,
                symbol: 'MAI',
                name: 'Mai Stablecoin',
              },
              price: '0.86985096',
              balance: '0',
              apy: '0.65053507775964222215',
              lstApy: '0',
              grossApy: '0.65053507775964222215',
              borrowMin: '0',
              borrowCap: '10000',
              totalBorrow: '8318.143695300422730107',
            },
          ],
        },
      },
      {
        chainId: common.ChainId.metis,
        account: '0x6859dA14835424957a1E6B397D8026B1D9fF7e1E',
        blockTag: 9723956,
        expected: {
          chainId: 1088,
          protocolId: 'aave-v3',
          marketId: 'metis',
          utilization: '0.90566901899748112035',
          healthRate: '1.17316588920765000099',
          netAPY: '0.01703506792443164733',
          totalSupplyUSD: '651222.83357431977924308968815744',
          totalBorrowUSD: '292970.85411820554313194246800317',
          supplies: [
            {
              token: {
                chainId: 1088,
                address: '0x4c078361FC9BbB78DF910800A991C7c3DD2F6ce0',
                decimals: 18,
                symbol: 'm.DAI',
                name: 'DAI Token',
              },
              price: '1.00002038',
              balance: '0',
              apy: '0.08922117566842144708',
              lstApy: '0',
              grossApy: '0.08922117566842144708',
              usageAsCollateralEnabled: true,
              ltv: '0.75',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
              supplyCap: '950000',
              totalSupply: '951629.4657945491884156',
            },
            {
              token: {
                chainId: 1088,
                address: '0xEA32A96608495e54156Ae48931A7c20f0dcc1a21',
                decimals: 6,
                symbol: 'm.USDC',
                name: 'USDC Token',
              },
              price: '1.00026504',
              balance: '404249.81361',
              apy: '0.0226843306506274095',
              lstApy: '0',
              grossApy: '0.0226843306506274095',
              usageAsCollateralEnabled: true,
              ltv: '0.8',
              liquidationThreshold: '0.85',
              isNotCollateral: false,
              supplyCap: '6000000',
              totalSupply: '5970660.291405',
            },
            {
              token: {
                chainId: 1088,
                address: '0xbB06DCA3AE6887fAbF931640f67cab3e3a16F4dC',
                decimals: 6,
                symbol: 'm.USDT',
                name: 'USDT Token',
              },
              price: '0.99968',
              balance: '0',
              apy: '0.03256071161295637577',
              lstApy: '0',
              grossApy: '0.03256071161295637577',
              usageAsCollateralEnabled: true,
              ltv: '0.75',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
              supplyCap: '5000000',
              totalSupply: '4998004.554061',
            },
            {
              token: {
                chainId: 1088,
                address: '0x420000000000000000000000000000000000000A',
                decimals: 18,
                symbol: 'WETH',
                name: 'Ether',
              },
              price: '2247.8',
              balance: '0',
              apy: '0.00592587703680170438',
              lstApy: '0',
              grossApy: '0.00592587703680170438',
              usageAsCollateralEnabled: true,
              ltv: '0.8',
              liquidationThreshold: '0.825',
              isNotCollateral: false,
              supplyCap: '300',
              totalSupply: '300.057251443015896968',
            },
            {
              token: {
                chainId: 1088,
                address: '0xDeadDeAddeAddEAddeadDEaDDEAdDeaDDeAD0000',
                decimals: 18,
                symbol: 'Metis',
                name: 'Metis Token',
              },
              price: '25.26107283',
              balance: '9772.580889776904413568',
              apy: '0.00036678993727261258',
              lstApy: '0',
              grossApy: '0.00036678993727261258',
              usageAsCollateralEnabled: false,
              ltv: '0',
              liquidationThreshold: '0',
              isNotCollateral: false,
              supplyCap: '360000',
              totalSupply: '268427.170576769985625264',
            },
          ],
          borrows: [
            {
              token: {
                chainId: 1088,
                address: '0x4c078361FC9BbB78DF910800A991C7c3DD2F6ce0',
                decimals: 18,
                symbol: 'm.DAI',
                name: 'DAI Token',
              },
              price: '1.00002038',
              balance: '0',
              apy: '0.12397608039130557217',
              lstApy: '0',
              grossApy: '0.12397608039130557217',
              borrowMin: '0',
              borrowCap: '950000',
              totalBorrow: '773648.819712205852752126',
            },
            {
              token: {
                chainId: 1088,
                address: '0xEA32A96608495e54156Ae48931A7c20f0dcc1a21',
                decimals: 6,
                symbol: 'm.USDC',
                name: 'USDC Token',
              },
              price: '1.00026504',
              balance: '1249.319064',
              apy: '0.0379114798618386383',
              lstApy: '0',
              grossApy: '0.0379114798618386383',
              borrowMin: '0',
              borrowCap: '4000000',
              totalBorrow: '4000496.790864',
            },
            {
              token: {
                chainId: 1088,
                address: '0xbB06DCA3AE6887fAbF931640f67cab3e3a16F4dC',
                decimals: 6,
                symbol: 'm.USDT',
                name: 'USDT Token',
              },
              price: '0.99968',
              balance: '0',
              apy: '0.04547726467489857161',
              lstApy: '0',
              grossApy: '0.04547726467489857161',
              borrowMin: '0',
              borrowCap: '4000000',
              totalBorrow: '4003292.757491',
            },
            {
              token: {
                chainId: 1088,
                address: '0x420000000000000000000000000000000000000A',
                decimals: 18,
                symbol: 'WETH',
                name: 'Ether',
              },
              price: '2247.8',
              balance: '19.947502441895519984',
              apy: '0.02413266844839324225',
              lstApy: '0',
              grossApy: '0.02413266844839324225',
              borrowMin: '0',
              borrowCap: '180',
              totalBorrow: '87.484603062472377336',
            },
            {
              token: {
                chainId: 1088,
                address: '0xDeadDeAddeAddEAddeadDEaDDEAdDeaDDeAD0000',
                decimals: 18,
                symbol: 'Metis',
                name: 'Metis Token',
              },
              price: '25.26107283',
              balance: '9773.266939501875097199',
              apy: '0.00822587912740514178',
              lstApy: '0',
              grossApy: '0.00822587912740514178',
              borrowMin: '0',
              borrowCap: '32000',
              totalBorrow: '14136.715839367056151531',
            },
          ],
        },
      },
    ];

    testCases.forEach(({ chainId, account, blockTag, expected }) => {
      it(`${common.toNetworkId(chainId)} market`, async function () {
        const protocol = new LendingProtocol(chainId);
        protocol.setBlockTag(blockTag);
        const _portfolio = await protocol.getPortfolio(account);
        const portfolio = JSON.parse(JSON.stringify(_portfolio));

        removePortfolioDynamicFields(expected);
        removePortfolioDynamicFields(portfolio);

        expect(JSON.stringify(portfolio)).to.eq(JSON.stringify(expected));
      }).timeout(30000);
    });
  });
});
